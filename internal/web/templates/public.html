{{define "content"}}
<div class="public-snippet-container" x-data="publicSnippet()">
    <!-- Loading state -->
    <div class="public-loading" x-show="loading">
        <div class="spinner"></div>
        <p>Loading snippet...</p>
    </div>
    
    <!-- Error state -->
    <div class="public-error" x-show="error" x-cloak>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="48" height="48">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        <h2>Snippet Not Found</h2>
        <p x-text="errorMessage"></p>
        <a href="{{.BasePath}}/" class="btn-primary" style="display: inline-block; margin-top: 1rem; padding: 0.5rem 1rem; text-decoration: none;">
            Go to Snipo
        </a>
    </div>
    
    <!-- Snippet content -->
    <div class="public-snippet" x-show="!loading && !error" x-cloak>
        <!-- Header -->
        <header class="public-header">
            <div class="public-header-left">
                <a href="{{.BasePath}}/" class="public-logo">
                    <img src="{{.BasePath}}/static/logo.png" alt="Snipo" width="24" height="24">
                    <span>Snipo</span>
                </a>
            </div>
            <div class="public-header-right">
                <button class="btn-icon" @click="copyCode()" title="Copy Code">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                    </svg>
                </button>
                <button x-show="isAuthenticated" class="btn-icon" @click="togglePublic()" :title="snippet.is_public ? 'Make Private' : 'Make Public'">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <template x-if="snippet.is_public">
                            <g>
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M2 12h20"></path>
                                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                            </g>
                        </template>
                        <template x-if="!snippet.is_public">
                            <g>
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                                <line x1="3" y1="3" x2="21" y2="21"></line>
                            </g>
                        </template>
                    </svg>
                </button>
                <a href="{{.BasePath}}/" class="btn-primary" style="padding: 0.5rem 1rem; text-decoration: none;">
                    Open Snipo
                </a>
            </div>
        </header>
        
        <!-- Snippet info -->
        <div class="public-info">
            <h1 class="public-title" x-text="snippet.title"></h1>
            <p class="public-description" x-show="snippet.description" x-text="snippet.description"></p>
            
            <div class="public-meta">
                <span class="language-badge" :style="{ background: getLanguageColor(snippet.language) }" x-text="snippet.language"></span>
                <template x-for="tag in (snippet.tags || [])" :key="tag.id">
                    <span class="tag-badge" x-text="tag.name"></span>
                </template>
                <span class="public-date">
                    Shared <span x-text="formatDate(snippet.created_at)"></span>
                </span>
            </div>
        </div>
        
        <!-- File tabs and actions -->
        <div class="public-files-tabs">
            <!-- File tabs (only for multi-file snippets) -->
            <div class="file-tabs" x-show="hasMultipleFiles()">
                <template x-for="(file, index) in getFiles()" :key="file.id || index">
                    <button 
                        class="file-tab" 
                        :class="{ 'active': activeFileIndex === index }"
                        @click="activeFileIndex = index">
                        <span x-text="file.filename"></span>
                    </button>
                </template>
            </div>
            <!-- Single file info (only for single-file snippets) -->
            <div class="file-info" x-show="!hasMultipleFiles()">
                <span class="file-name" x-text="getCurrentFilename()"></span>
            </div>
            <!-- File actions (always visible) -->
            <div class="file-actions">
                <button class="btn-icon-small" @click="downloadFile()" title="Download file">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                </button>
                <button class="btn-icon-small" @click="copyFileUrl()" title="Copy file URL">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                    </svg>
                </button>
            </div>
        </div>
        
        <!-- Code -->
        <div class="public-code">
            <pre><code :class="'language-' + getCurrentLanguage()" x-html="highlightCode(getCurrentContent(), getCurrentLanguage())"></code></pre>
        </div>
        
        <!-- Footer -->
        <footer class="public-footer">
            <p>Powered by <a href="{{.BasePath}}/">Snipo</a> - A personal code snippet manager</p>
        </footer>
    </div>
</div>

<style>
    .public-snippet-container {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
    }
    
    .public-loading, .public-error {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 2rem;
        text-align: center;
    }
    
    .public-error svg {
        color: var(--snipo-danger);
        margin-bottom: 1rem;
    }
    
    .public-snippet {
        flex: 1;
        display: flex;
        flex-direction: column;
    }
    
    .public-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1rem 2rem;
        background: var(--pico-card-background-color);
        border-bottom: 1px solid var(--pico-muted-border-color);
    }
    
    .public-logo {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 700;
        font-size: 1.25rem;
        color: var(--snipo-primary);
        text-decoration: none;
    }
    
    .public-header-right {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .public-info {
        padding: 2rem;
        background: var(--pico-card-background-color);
        border-bottom: 1px solid var(--pico-muted-border-color);
    }
    
    .public-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin: 0 0 0.5rem 0;
    }
    
    .public-description {
        color: var(--pico-muted-color);
        margin: 0 0 1rem 0;
    }
    
    .public-meta {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 0.5rem;
    }
    
    .public-date {
        color: var(--pico-muted-color);
        font-size: 0.85rem;
        margin-left: auto;
    }
    
    .public-files-tabs {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 1rem;
        padding: 0.5rem 1rem;
        background: var(--pico-card-background-color);
        border-bottom: 1px solid var(--pico-muted-border-color);
        overflow-x: auto;
    }
    
    .file-tabs {
        display: flex;
        gap: 0.25rem;
        flex: 1;
        overflow-x: auto;
    }
    
    .file-info {
        display: flex;
        align-items: center;
        flex: 1;
    }
    
    .file-name {
        padding: 0.5rem 1rem;
        font-size: 0.85rem;
        color: var(--pico-muted-color);
        font-family: var(--font-mono);
    }
    
    .file-tab {
        padding: 0.5rem 1rem;
        background: transparent;
        border: 1px solid var(--pico-muted-border-color);
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.85rem;
        white-space: nowrap;
        transition: all 0.2s;
        color: var(--pico-contrast) !important;
    }
    
    .file-tab:hover {
        background: var(--pico-secondary-background);
        color: var(--pico-contrast) !important;
    }
    
    .file-tab.active {
        background: var(--snipo-primary);
        color: white !important;
        border-color: var(--snipo-primary);
    }
    
    .file-actions {
        display: flex;
        gap: 0.25rem;
    }
    
    .btn-icon-small {
        padding: 0.35rem;
        background: transparent;
        border: 1px solid var(--pico-muted-border-color);
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
        color: var(--pico-contrast) !important;
    }
    
    .btn-icon-small svg {
        stroke: currentColor;
    }
    
    .btn-icon-small:hover {
        background: var(--pico-secondary-background);
        border-color: var(--snipo-primary);
        color: var(--snipo-primary) !important;
    }
    
    .public-code {
        flex: 1;
        overflow: auto;
        background: var(--editor-bg);
    }
    
    .public-code pre {
        margin: 0;
        padding: 1.5rem 2rem;
        background: transparent !important;
        font-size: 0.9rem;
        line-height: 1.6;
    }
    
    .public-code code {
        background: transparent !important;
        font-family: var(--font-mono);
        display: inline;
        padding: 0;
    }
    
    .public-code code * {
        display: inline;
        margin: 0;
        padding: 0;
        line-height: inherit;
    }
    
    .public-footer {
        padding: 1rem 2rem;
        text-align: center;
        background: var(--pico-card-background-color);
        border-top: 1px solid var(--pico-muted-border-color);
        font-size: 0.85rem;
        color: var(--pico-muted-color);
    }
    
    .public-footer a {
        color: var(--snipo-primary);
    }
</style>
{{end}}
