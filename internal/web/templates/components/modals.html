{{define "modals"}}
<!-- Delete confirmation modal -->
<div class="modal-backdrop" x-show="showDeleteModal" x-cloak @click.self="showDeleteModal = false">
    <div class="modal">
        <div class="modal-header">
            <h3>Delete Snippet</h3>
            <button class="btn-icon" @click="showDeleteModal = false">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to delete "<span x-text="deleteTarget?.title"></span>"?</p>
            <p class="text-sm text-muted">This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
            <button @click="showDeleteModal = false">Cancel</button>
            <button class="btn-primary" style="background: var(--snipo-danger); border-color: var(--snipo-danger);"
                @click="deleteSnippet()">
                Delete
            </button>
        </div>
    </div>
</div>

<!-- Settings modal -->
<div class="modal-backdrop" x-show="showSettings" x-cloak @click.self="closeSettings()">
    <div class="modal settings-modal">
        <div class="modal-header">
            <h3>Settings</h3>
            <button class="btn-icon" @click="closeSettings()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>

        <!-- Settings tabs -->
        <div class="settings-tabs">
            <button class="settings-tab" :class="{ active: settingsTab === 'general' }"
                @click="settingsTab = 'general'">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path
                        d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                    </path>
                </svg>
                General
            </button>
            <button class="settings-tab" :class="{ active: settingsTab === 'appearance' }"
                @click="settingsTab = 'appearance'">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
                Appearance
            </button>
            <button class="settings-tab" :class="{ active: settingsTab === 'editor' }"
                @click="settingsTab = 'editor'">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
                Editor
            </button>
                        <button class="settings-tab" :class="{ active: settingsTab === 'apikeys' }"
                @click="settingsTab = 'apikeys'">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                    <path
                        d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4">
                    </path>
                </svg>
                API Keys
            </button>
            <button class="settings-tab" :class="{ active: settingsTab === 'backup' }"
                @click="settingsTab = 'backup'; loadS3Status()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                Backup
            </button>
            <button class="settings-tab" :class="{ active: settingsTab === 'gist' }"
                @click="settingsTab = 'gist'; loadGistConfig(); loadGistMappings()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
                </svg>
                GitHub Gist
            </button>
        </div>

        <div class="modal-body">
            <!-- General tab -->
            <div x-show="settingsTab === 'general'">
                <h4 style="margin-bottom: 1rem; font-size: 1rem;">General Settings</h4>
                <div class="editor-field">
                    <label class="checkbox-label">
                        <input type="checkbox" x-model="settings.archive_enabled" @change="updateSettings()">
                        <span>Enable Snippet Archiving</span>
                    </label>
                    <p class="text-sm text-muted" style="margin-top: 0.25rem;">Allow snippets to be archived instead
                        of permanently deleted.</p>
                </div>
                <div class="editor-field" style="margin-top: 1rem;">
                    <label class="checkbox-label">
                        <input type="checkbox" x-model="settings.history_enabled" @change="updateSettings()">
                        <span>Enable Modification History</span>
                    </label>
                    <p class="text-sm text-muted" style="margin-top: 0.25rem;">Track all changes to snippets. Previous versions can be viewed and restored at any time.</p>
                </div>
                <div class="editor-field" style="margin-top: 1rem;">
                    <label class="checkbox-label">
                        <input type="checkbox" x-model="settings.disable_login" @change="updateSettings()">
                        <span>Disable Login Page</span>
                    </label>
                    <p class="text-sm text-muted" style="margin-top: 0.25rem;">
                        Hide the login page and allow direct access to the application without session authentication. 
                        <strong>Note:</strong> API token operations always require password verification for security.
                    </p>
                </div>
                <div class="editor-field" style="margin-top: 1rem;">
                    <label class="checkbox-label">
                        <input type="checkbox" x-model="settings.exclude_first_line_on_copy" @change="updateSettings()">
                        <span>Exclude First Line When Copying</span>
                    </label>
                    <p class="text-sm text-muted" style="margin-top: 0.25rem;">
                        When copying snippets, automatically exclude the first line (useful for shebang lines like <code>#!/usr/bin/bash</code> or <code>&lt;?php</code>).
                    </p>
                </div>
            </div>

            <!-- Appearance tab -->
            <div x-show="settingsTab === 'appearance'">
                <h4 style="margin-bottom: 1rem; font-size: 1rem;">Appearance Settings</h4>
                <p class="text-sm text-muted" style="margin-bottom: 1.5rem;">
                    Customize the visual appearance of previews and content display.
                </p>

                <div class="editor-field">
                    <label>Markdown Preview Font Size</label>
                    <select x-model.number="settings.markdown_font_size" @change="updateSettings(); applyMarkdownFontSize()">
                        <option value="10">10px</option>
                        <option value="11">11px</option>
                        <option value="12">12px</option>
                        <option value="13">13px</option>
                        <option value="14">14px (Default)</option>
                        <option value="15">15px</option>
                        <option value="16">16px</option>
                        <option value="18">18px</option>
                        <option value="20">20px</option>
                        <option value="22">22px</option>
                    </select>
                    <p class="text-sm text-muted" style="margin-top: 0.25rem;">Adjust the font size for markdown file previews.</p>
                </div>

                <div class="editor-field" style="margin-top: 1.5rem;">
                    <label>
                        Custom CSS
                        <span class="text-sm text-muted" style="font-weight: normal; margin-left: 0.5rem;">
                            (Advanced)
                        </span>
                    </label>
                    <textarea 
                        x-model="settings.custom_css" 
                        @input="customCssChanged = true"
                        placeholder="/* Add your custom CSS here */"
                        rows="10"
                        style="font-family: var(--font-mono); font-size: 13px; resize: vertical; min-height: 150px;"
                    ></textarea>
                    <div style="margin-top: 0.5rem;">
                        <p class="text-sm text-muted" style="margin-bottom: 0.5rem;">
                            Override default styles with custom CSS. Changes apply immediately after saving.
                        </p>
                        <details style="margin-top: 0.75rem;">
                            <summary class="text-sm" style="cursor: pointer; user-select: none; font-weight: 500;">
                                <span style="color: var(--snipo-accent);">ðŸ“– View CSS Customization Guide</span>
                            </summary>
                            <div style="margin-top: 0.75rem; padding: 1rem; background: var(--snipo-bg-secondary); border-radius: 8px;">
                                <p class="text-sm" style="margin-bottom: 0.75rem;"><strong>Available CSS Variables:</strong></p>
                                <pre class="text-sm" style="margin: 0; padding: 0.75rem; background: var(--snipo-bg-primary); border-radius: 4px; overflow-x: auto; font-size: 12px;">--snipo-primary: Main theme color
--snipo-accent: Accent/highlight color
--snipo-bg-primary: Primary background
--snipo-bg-secondary: Secondary background
--snipo-text-primary: Primary text color
--snipo-text-secondary: Secondary text color
--snipo-border: Border color
--snipo-danger: Error/delete color
--snipo-success: Success color</pre>
                                <p class="text-sm" style="margin-top: 0.75rem; margin-bottom: 0.5rem;"><strong>Example - Change accent color:</strong></p>
                                <pre class="text-sm" style="margin: 0; padding: 0.75rem; background: var(--snipo-bg-primary); border-radius: 4px; overflow-x: auto; font-size: 12px;">:root {
  --snipo-accent: #ff6b6b;
}</pre>
                                <p class="text-sm" style="margin-top: 0.75rem; margin-bottom: 0.5rem;"><strong>Example - Custom sidebar styling:</strong></p>
                                <pre class="text-sm" style="margin: 0; padding: 0.75rem; background: var(--snipo-bg-primary); border-radius: 4px; overflow-x: auto; font-size: 12px;">.sidebar {
  background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
}

.snippet-item:hover {
  background: rgba(255, 107, 107, 0.1);
}</pre>
                                <p class="text-sm text-muted" style="margin-top: 0.75rem;">
                                    ðŸ’¡ <strong>Tip:</strong> Use browser DevTools (F12) to inspect elements and find class names.
                                    See <a href="https://github.com/MohamedElashri/snipo/blob/main/docs/customization.md" target="_blank" style="color: var(--snipo-accent);">full documentation</a> for more examples.
                                </p>
                            </div>
                        </details>
                    </div>
                    <button 
                        @click="saveAndApplyCustomCSS()" 
                        class="btn-primary" 
                        style="margin-top: 0.75rem; width: 100%;"
                        :disabled="!customCssChanged"
                    >
                        <span x-show="!customCssChanged">Custom CSS Saved</span>
                        <span x-show="customCssChanged">Save and Apply Custom CSS</span>
                    </button>
                </div>
            </div>

            
            <!-- API Keys tab -->
            <div x-show="settingsTab === 'apikeys'">
                <!-- Create new token -->
                <div class="api-token-form">
                    <h4 style="margin-bottom: 1rem; font-size: 1rem;">Create New API Token</h4>

                    <!-- Show created token -->
                    <div x-show="createdToken" class="created-token-box">
                        <p class="text-sm" style="margin-bottom: 0.5rem;"><strong>Token created!</strong> Copy it
                            now - it won't be shown again.</p>
                        <div style="display: flex; gap: 0.5rem;">
                            <input type="text" :value="createdToken" readonly
                                style="font-family: var(--font-mono); font-size: 0.8rem;">
                            <button class="btn-primary" @click="copyToken()"
                                style="white-space: nowrap;">Copy</button>
                        </div>
                    </div>

                    <div x-show="!createdToken">
                        <div class="editor-field">
                            <label>Token Name</label>
                            <input type="text" x-model="newToken.name" placeholder="e.g., CLI Access">
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="editor-field">
                                <label>Permissions</label>
                                <select x-model="newToken.permissions">
                                    <option value="read">Read Only</option>
                                    <option value="write">Read & Write</option>
                                    <option value="admin">Admin</option>
                                </select>
                            </div>
                            <div class="editor-field">
                                <label>Expires In (days)</label>
                                <input type="number" x-model="newToken.expires_in_days" min="1" max="365"
                                    placeholder="30">
                            </div>
                        </div>
                        <button class="btn-primary" @click="createApiToken()" style="width: 100%;">
                            Create Token
                        </button>
                    </div>
                </div>

                <!-- Existing tokens -->
                <div class="api-tokens-list" style="margin-top: 1.5rem;">
                    <h4 style="margin-bottom: 1rem; font-size: 1rem;">Existing Tokens</h4>

                    <div x-show="apiTokens.length === 0" class="text-sm text-muted">
                        No API tokens yet.
                    </div>

                    <template x-for="token in apiTokens" :key="token.id">
                        <div class="api-token-item">
                            <div class="api-token-info">
                                <div class="api-token-name" x-text="token.name"></div>
                                <div class="api-token-meta">
                                    <span class="api-token-permission" x-text="token.permissions"></span>
                                    <span>Created: <span x-text="formatTokenDate(token.created_at)"></span></span>
                                    <span x-show="token.expires_at">Expires: <span
                                            x-text="formatTokenDate(token.expires_at)"></span></span>
                                    <span x-show="token.last_used_at">Last used: <span
                                            x-text="formatTokenDate(token.last_used_at)"></span></span>
                                </div>
                            </div>
                            <button class="btn-icon danger" @click="deleteApiToken(token.id)" title="Delete token">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path
                                        d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                    </path>
                                </svg>
                            </button>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Backup tab -->
            <div x-show="settingsTab === 'backup'">
                <!-- Export Section -->
                <div class="backup-section">
                    <h4 style="margin-bottom: 1rem; font-size: 1rem;">Export Backup</h4>
                    <p class="text-sm text-muted" style="margin-bottom: 1rem;">
                        Download a complete backup of all your snippets, tags, and folders.
                    </p>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div class="editor-field">
                            <label>Format</label>
                            <select x-model="backupOptions.format">
                                <option value="json">JSON</option>
                                <option value="zip">ZIP Archive</option>
                            </select>
                        </div>
                        <div class="editor-field">
                            <label>Password (optional)</label>
                            <input type="password" x-model="backupOptions.password" placeholder="Encrypt backup">
                        </div>
                    </div>

                    <button class="btn-primary" @click="exportBackup()" :disabled="backupLoading"
                        style="width: 100%;">
                        <span x-show="!backupLoading">Download Backup</span>
                        <span x-show="backupLoading">Exporting...</span>
                    </button>
                </div>

                <!-- Import Section -->
                <div class="backup-section" style="margin-top: 2rem;">
                    <h4 style="margin-bottom: 1rem; font-size: 1rem;">Import Backup</h4>
                    <p class="text-sm text-muted" style="margin-bottom: 1rem;">
                        Restore snippets from a backup file.
                    </p>

                    <div class="editor-field">
                        <label>Backup File</label>
                        <input type="file" @change="backupFile = $event.target.files[0]" accept=".json,.zip,.enc">
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div class="editor-field">
                            <label>Import Strategy</label>
                            <select x-model="importOptions.strategy">
                                <option value="merge">Merge (add new)</option>
                                <option value="skip">Skip existing</option>
                                <option value="replace">Replace all</option>
                            </select>
                        </div>
                        <div class="editor-field">
                            <label>Password (if encrypted)</label>
                            <input type="password" x-model="importOptions.password"
                                placeholder="Decryption password">
                        </div>
                    </div>

                    <button class="btn-primary" @click="importBackup()" :disabled="backupLoading || !backupFile"
                        style="width: 100%;">
                        <span x-show="!backupLoading">Import Backup</span>
                        <span x-show="backupLoading">Importing...</span>
                    </button>

                    <div x-show="importResult" class="import-result"
                        style="margin-top: 1rem; padding: 1rem; background: var(--snipo-bg-tertiary); border-radius: 8px;">
                        <p class="text-sm"><strong>Import Complete:</strong></p>
                        <ul class="text-sm" style="margin: 0.5rem 0 0 1rem;">
                            <li x-text="'Snippets: ' + (importResult?.snippets_imported || 0)"></li>
                            <li x-text="'Tags: ' + (importResult?.tags_imported || 0)"></li>
                            <li x-text="'Folders: ' + (importResult?.folders_imported || 0)"></li>
                        </ul>
                    </div>
                </div>

                <!-- S3 Section -->
                <div class="backup-section"
                    style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--snipo-border);">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                        <h4 style="font-size: 1rem;">S3 Cloud Backup</h4>
                        <span x-show="s3Status.enabled" class="badge badge-success">Enabled</span>
                        <span x-show="!s3Status.enabled" class="badge badge-muted">Not Configured</span>
                    </div>

                    <template x-if="!s3Status.enabled">
                        <p class="text-sm text-muted">
                            S3 backup is not configured. Set the following environment variables to enable:
                            <code
                                style="display: block; margin-top: 0.5rem; padding: 0.5rem; background: var(--snipo-bg-tertiary); border-radius: 4px; font-size: 0.75rem;">
                                SNIPO_S3_ENABLED=true<br>
                                SNIPO_S3_ENDPOINT=s3.amazonaws.com<br>
                                SNIPO_S3_ACCESS_KEY=key<br>
                                SNIPO_S3_SECRET_KEY=secret<br>
                                SNIPO_S3_BUCKET=bucket
                            </code>
                        </p>
                    </template>

                    <template x-if="s3Status.enabled">
                        <div>
                            <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                                <button class="btn-primary" @click="syncToS3()" :disabled="backupLoading"
                                    style="flex: 1;">
                                    <span x-show="!backupLoading">Sync to S3</span>
                                    <span x-show="backupLoading">Syncing...</span>
                                </button>
                                <button @click="loadS3Backups()" :disabled="backupLoading" style="flex: 1;">
                                    Refresh List
                                </button>
                            </div>

                            <div class="s3-backups-list">
                                <h5 style="margin-bottom: 0.5rem; font-size: 0.9rem;">Available Backups</h5>
                                <div x-show="s3Backups.length === 0" class="text-sm text-muted">
                                    No backups in S3 yet.
                                </div>
                                <template x-for="backup in s3Backups" :key="backup.key">
                                    <div class="s3-backup-item">
                                        <div class="s3-backup-info">
                                            <div class="s3-backup-name" x-text="backup.key.replace('backups/', '')">
                                            </div>
                                            <div class="s3-backup-meta text-sm text-muted">
                                                <span x-text="formatFileSize(backup.size)"></span> â€¢
                                                <span x-text="formatDate(backup.last_modified)"></span>
                                            </div>
                                        </div>
                                        <div style="display: flex; gap: 0.5rem;">
                                            <button class="btn-icon" @click="restoreFromS3(backup.key)"
                                                title="Restore">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                    stroke-width="2" width="16" height="16">
                                                    <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8">
                                                    </path>
                                                    <path d="M3 3v5h5"></path>
                                                </svg>
                                            </button>
                                            <button class="btn-icon danger" @click="deleteS3Backup(backup.key)"
                                                title="Delete">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                    stroke-width="2" width="16" height="16">
                                                    <polyline points="3 6 5 6 21 6"></polyline>
                                                    <path
                                                        d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                                    </path>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- GitHub Gist tab -->
            <div x-show="settingsTab === 'gist'">
                <h4 style="margin-bottom: 1rem; font-size: 1rem;">GitHub Gist Sync</h4>
                <p class="text-sm text-muted" style="margin-bottom: 1.5rem;">
                    Sync your snippets with GitHub Gists. Requires a GitHub Personal Access Token with <code>gist</code> scope.
                </p>

                <!-- Connection Status -->
                <div class="backup-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <div>
                            <h5 style="margin: 0; font-size: 0.9rem;">Connection Status</h5>
                            <p class="text-sm text-muted" style="margin: 0.25rem 0 0 0;">
                                <template x-if="gistConfig.has_token && gistConfig.enabled">
                                    <span style="color: var(--snipo-success);">âœ“ Connected as <strong x-text="gistConfig.github_username"></strong></span>
                                </template>
                                <template x-if="!gistConfig.has_token || !gistConfig.enabled">
                                    <span style="color: var(--snipo-text-secondary);">Not connected</span>
                                </template>
                            </p>
                        </div>
                        <template x-if="gistConfig.has_token">
                            <button class="btn-secondary" @click="testGistConnection()" :disabled="gistTestingConnection">
                                <span x-show="!gistTestingConnection">Test Connection</span>
                                <span x-show="gistTestingConnection">Testing...</span>
                            </button>
                        </template>
                    </div>

                    <!-- Token Input -->
                    <div class="editor-field" style="margin-bottom: 1rem;">
                        <label>GitHub Personal Access Token</label>
                        <div style="display: flex; gap: 0.5rem;">
                            <input type="password" x-model="gistTokenInput" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" 
                                   style="flex: 1;" x-show="showGistTokenInput || !gistConfig.has_token">
                            <button class="btn-secondary" @click="showGistTokenInput = !showGistTokenInput" 
                                    x-show="gistConfig.has_token && !showGistTokenInput">
                                Change Token
                            </button>
                        </div>
                        <small class="text-sm text-muted" style="display: block; margin-top: 0.25rem;">
                            <a href="https://github.com/settings/tokens/new?scopes=gist&description=Snipo" 
                               target="_blank" style="color: var(--snipo-primary);">Generate token</a> 
                            with <code>gist</code> scope
                        </small>
                    </div>

                    <!-- Enable Sync -->
                    <div class="editor-field" style="margin-bottom: 1rem;">
                        <label class="checkbox-label">
                            <input type="checkbox" x-model="gistConfig.enabled">
                            <span>Enable GitHub Gist Sync</span>
                        </label>
                    </div>

                    <!-- Auto Sync -->
                    <div class="editor-field" style="margin-bottom: 1rem;">
                        <label class="checkbox-label">
                            <input type="checkbox" x-model="gistConfig.auto_sync_enabled" :disabled="!gistConfig.enabled">
                            <span>Enable Automatic Background Sync</span>
                        </label>
                    </div>

                    <!-- Sync Interval -->
                    <div class="editor-field" style="margin-bottom: 1rem;">
                        <label>Sync Interval</label>
                        <select x-model.number="gistConfig.sync_interval_minutes" :disabled="!gistConfig.enabled">
                            <option value="5">Every 5 minutes</option>
                            <option value="15">Every 15 minutes</option>
                            <option value="30">Every 30 minutes</option>
                            <option value="60">Every hour</option>
                        </select>
                    </div>

                    <!-- Conflict Strategy -->
                    <div class="editor-field" style="margin-bottom: 1rem;">
                        <label>Conflict Resolution Strategy</label>
                        <select x-model="gistConfig.conflict_resolution_strategy" :disabled="!gistConfig.enabled">
                            <option value="manual">Manual Resolution</option>
                            <option value="snipo_wins">Snipo Always Wins</option>
                            <option value="gist_wins">Gist Always Wins</option>
                            <option value="newest_wins">Newest Version Wins</option>
                        </select>
                        <small class="text-sm text-muted" style="display: block; margin-top: 0.25rem;">
                            How to handle conflicts when both snippet and gist are modified
                        </small>
                    </div>

                    <!-- Last Sync -->
                    <template x-if="gistConfig.last_full_sync_at">
                        <p class="text-sm text-muted" style="margin-bottom: 1rem;">
                            Last sync: <span x-text="formatGistDate(gistConfig.last_full_sync_at)"></span>
                        </p>
                    </template>

                    <!-- Action Buttons -->
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button class="btn-primary" @click="saveGistConfig()" style="flex: 1; min-width: 150px;">
                            Save Configuration
                        </button>
                        <button class="btn-primary" @click="enableSyncForAll()" :disabled="!gistConfig.enabled || gistSyncing" style="flex: 1; min-width: 150px;">
                            <span x-show="!gistSyncing">Enable Sync for All</span>
                            <span x-show="gistSyncing">Processing...</span>
                        </button>
                        <button class="btn-primary" @click="syncAllGists()" :disabled="!gistConfig.enabled || gistSyncing" style="flex: 1; min-width: 150px;">
                            <span x-show="!gistSyncing">Sync Now</span>
                            <span x-show="gistSyncing">Syncing...</span>
                        </button>
                        <template x-if="gistConfig.has_token">
                            <button class="btn-secondary" @click="clearGistConfig()">
                                Disconnect
                            </button>
                        </template>
                    </div>
                    
                    <!-- Progress Bar -->
                    <div x-show="gistSyncing" style="margin-top: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <span class="text-sm" x-text="gistSyncProgress.message" style="color: var(--snipo-text-secondary);"></span>
                            <span class="text-sm" x-show="gistSyncProgress.total > 0" style="color: var(--snipo-text-secondary);">
                                <span x-text="gistSyncProgress.current"></span>/<span x-text="gistSyncProgress.total"></span>
                            </span>
                        </div>
                        <div style="width: 100%; height: 8px; background: var(--snipo-border); border-radius: 4px; overflow: hidden;">
                            <div style="height: 100%; background: var(--snipo-primary); transition: width 0.3s ease;" 
                                 :style="`width: ${gistSyncProgress.total > 0 ? (gistSyncProgress.current / gistSyncProgress.total * 100) : 0}%`">
                            </div>
                        </div>
                    </div>
                    
                    <p class="text-sm text-muted" style="margin-top: 0.5rem;">
                        <strong>Enable Sync for All:</strong> Creates gists for all snippets. <strong>Sync Now:</strong> Syncs already-enabled snippets.
                    </p>
                </div>

                <!-- Mappings Section -->
                <div class="backup-section" style="margin-top: 1.5rem;">
                    <h5 style="margin-bottom: 0.75rem; font-size: 0.9rem;">Synced Snippets (<span x-text="gistMappings.length"></span>)</h5>
                    <div style="max-height: 300px; overflow-y: auto;">
                        <template x-if="gistMappings.length === 0">
                            <p class="text-sm text-muted">No snippets synced yet.</p>
                        </template>
                        <template x-for="mapping in gistMappings" :key="mapping.id">
                            <div style="padding: 0.75rem; border: 1px solid var(--snipo-border); border-radius: 6px; margin-bottom: 0.5rem;">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div style="flex: 1;">
                                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                                            <span :class="getSyncStatusBadge(mapping.sync_status).class" x-text="getSyncStatusBadge(mapping.sync_status).icon"></span>
                                            <strong style="font-size: 0.875rem;" x-text="mapping.snippet_id"></strong>
                                        </div>
                                        <a :href="mapping.gist_url" target="_blank" class="text-sm" style="color: var(--snipo-primary);">
                                            View on GitHub â†’
                                        </a>
                                    </div>
                                    <button class="btn-icon" @click="deleteGistMapping(mapping.id)" title="Remove mapping">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                            <polyline points="3 6 5 6 21 6"></polyline>
                                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Conflicts Section -->
                <template x-if="gistConflicts.length > 0">
                    <div class="backup-section" style="margin-top: 1.5rem;">
                        <h5 style="margin-bottom: 0.75rem; font-size: 0.9rem; color: var(--snipo-warning);">
                            âš  Conflicts (<span x-text="gistConflicts.length"></span>)
                        </h5>
                        <template x-for="conflict in gistConflicts" :key="conflict.id">
                            <div style="padding: 0.75rem; border: 1px solid var(--snipo-warning); border-radius: 6px; margin-bottom: 0.5rem; background: rgba(var(--snipo-warning-rgb), 0.05);">
                                <p style="font-size: 0.875rem; margin-bottom: 0.5rem;">
                                    <strong x-text="conflict.snippet_id"></strong>
                                </p>
                                <div style="display: flex; gap: 0.5rem;">
                                    <button class="btn-secondary" @click="resolveGistConflict(conflict.id, 'snipo_wins')" style="flex: 1; font-size: 0.8rem;">
                                        Keep Snipo
                                    </button>
                                    <button class="btn-secondary" @click="resolveGistConflict(conflict.id, 'gist_wins')" style="flex: 1; font-size: 0.8rem;">
                                        Keep Gist
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </template>
            </div>

            <!-- Editor tab -->
            <div x-show="settingsTab === 'editor'">
                <h4 style="margin-bottom: 1rem; font-size: 1rem;">Editor Settings</h4>
                <p class="text-sm text-muted" style="margin-bottom: 1.5rem;">
                    Customize the code editor appearance and behavior.
                </p>

                <!-- Visual Settings -->
                <div style="margin-bottom: 1.5rem;">
                    <h5 style="margin-bottom: 0.75rem; font-size: 0.9rem;">Visual</h5>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div class="editor-field">
                            <label>Font Size</label>
                            <select x-model.number="settings.editor_font_size" @change="updateSettings(); applyEditorSettings()">
                                <option value="10">10px</option>
                                <option value="11">11px</option>
                                <option value="12">12px</option>
                                <option value="13">13px</option>
                                <option value="14">14px (Default)</option>
                                <option value="15">15px</option>
                                <option value="16">16px</option>
                                <option value="18">18px</option>
                                <option value="20">20px</option>
                                <option value="22">22px</option>
                            </select>
                            <small style="color: var(--pico-muted-color); font-size: 0.75rem; margin-top: 0.25rem; display: block;">
                                Note: Your browser's minimum font size setting may prevent smaller sizes from displaying.
                                <a href="#" @click.prevent="showFontSizeHelp = true" style="color: var(--snipo-primary); text-decoration: underline; margin-left: 0.25rem;">How to change?</a>
                            </small>
                        </div>

                        <div class="editor-field">
                            <label>Editor Theme</label>
                            <select x-model="settings.editor_theme" @change="updateSettings(); applyEditorSettings()">
                                <option value="auto">Auto (Follow App Theme)</option>
                                <optgroup label="Light Themes">
                                    <option value="chrome">Chrome</option>
                                    <option value="clouds">Clouds</option>
                                    <option value="github">GitHub</option>
                                    <option value="kuroir">Kuroir</option>
                                    <option value="textmate">TextMate</option>
                                    <option value="xcode">Xcode</option>
                                </optgroup>
                                <optgroup label="Dark Themes">
                                    <option value="ambiance">Ambiance</option>
                                    <option value="chaos">Chaos</option>
                                    <option value="cobalt">Cobalt</option>
                                    <option value="dracula">Dracula</option>
                                    <option value="monokai">Monokai</option>
                                    <option value="twilight">Twilight</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>

                    <div class="editor-field">
                        <label class="checkbox-label">
                            <input type="checkbox" x-model="settings.editor_show_gutter" @change="updateSettings(); applyEditorSettings()">
                            <span>Show Line Numbers</span>
                        </label>
                        <p class="text-sm text-muted" style="margin-top: 0.25rem;">Display line numbers in the editor gutter.</p>
                    </div>

                    <div class="editor-field" style="margin-top: 1rem;">
                        <label class="checkbox-label">
                            <input type="checkbox" x-model="settings.editor_highlight_active_line" @change="updateSettings(); applyEditorSettings()">
                            <span>Highlight Active Line</span>
                        </label>
                        <p class="text-sm text-muted" style="margin-top: 0.25rem;">Highlight the line where the cursor is located.</p>
                    </div>

                    <div class="editor-field" style="margin-top: 1rem;">
                        <label class="checkbox-label">
                            <input type="checkbox" x-model="settings.editor_show_indent_guides" @change="updateSettings(); applyEditorSettings()">
                            <span>Show Indent Guides</span>
                        </label>
                        <p class="text-sm text-muted" style="margin-top: 0.25rem;">Display vertical guides for indentation levels.</p>
                    </div>

                    <div class="editor-field" style="margin-top: 1rem;">
                        <label class="checkbox-label">
                            <input type="checkbox" x-model="settings.editor_show_print_margin" @change="updateSettings(); applyEditorSettings()">
                            <span>Show Print Margin</span>
                        </label>
                        <p class="text-sm text-muted" style="margin-top: 0.25rem;">Display a vertical line at column 80.</p>
                    </div>
                </div>

                <!-- Editing Behavior -->
                <div style="margin-bottom: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--snipo-border);">
                    <h5 style="margin-bottom: 0.75rem; font-size: 0.9rem;">Editing Behavior</h5>

                    <div class="editor-field">
                        <label>Tab Size</label>
                        <select x-model.number="settings.editor_tab_size" @change="updateSettings(); applyEditorSettings()">
                            <option value="2">2 spaces (Default)</option>
                            <option value="4">4 spaces</option>
                            <option value="8">8 spaces</option>
                        </select>
                    </div>

                    <div class="editor-field" style="margin-top: 1rem;">
                        <label class="checkbox-label">
                            <input type="checkbox" x-model="settings.editor_use_soft_tabs" @change="updateSettings(); applyEditorSettings()">
                            <span>Use Soft Tabs (Spaces)</span>
                        </label>
                        <p class="text-sm text-muted" style="margin-top: 0.25rem;">Insert spaces instead of tab characters.</p>
                    </div>

                    <div class="editor-field" style="margin-top: 1rem;">
                        <label class="checkbox-label">
                            <input type="checkbox" x-model="settings.editor_word_wrap" @change="updateSettings(); applyEditorSettings()">
                            <span>Word Wrap</span>
                        </label>
                        <p class="text-sm text-muted" style="margin-top: 0.25rem;">Wrap long lines to fit in the editor width.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- New Folder modal -->
<div class="modal-backdrop" x-show="showFolderModal" x-cloak @click.self="showFolderModal = false">
    <div class="modal" style="max-width: 400px;">
        <div class="modal-header">
            <h3 x-text="editingFolder?.id ? 'Rename Folder' : 'New Folder'"></h3>
            <button class="btn-icon" @click="showFolderModal = false">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <div class="editor-field">
                <label>Folder Name</label>
                <input type="text" x-model="editingFolder.name" @keydown.enter="saveFolder()" autofocus>
            </div>
            <div class="editor-field" x-show="!editingFolder?.id">
                <label>Parent Folder (optional)</label>
                <select x-model="editingFolder.parent_id">
                    <option value="">No parent</option>
                    <template x-for="folder in folders" :key="folder.id">
                        <option :value="folder.id" x-text="folder.name"></option>
                    </template>
                </select>
            </div>
        </div>
        <div class="modal-footer">
            <button @click="showFolderModal = false">Cancel</button>
            <button class="btn-primary" @click="saveFolder()">Save</button>
        </div>
    </div>
</div>

<!-- Rename Tag modal -->
<div class="modal-backdrop" x-show="showTagModal" x-cloak @click.self="showTagModal = false">
    <div class="modal" style="max-width: 400px;">
        <div class="modal-header">
            <h3>Rename Tag</h3>
            <button class="btn-icon" @click="showTagModal = false">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <div class="editor-field">
                <label>Tag Name</label>
                <input type="text" x-model="editingTag.name" @keydown.enter="saveTag()" autofocus>
            </div>
        </div>
        <div class="modal-footer">
            <button @click="showTagModal = false">Cancel</button>
            <button class="btn-primary" @click="saveTag()">Save</button>
        </div>
    </div>
</div>

<!-- History modal -->
<div class="modal-backdrop" x-show="showHistory" x-cloak @click.self="closeHistory()">
    <div class="modal" style="max-width: 900px; max-height: 80vh;">
        <div class="modal-header">
            <h3>Snippet History</h3>
            <button class="btn-icon" @click="closeHistory()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="modal-body" style="overflow-y: auto; max-height: calc(80vh - 120px);">
            <p class="text-sm text-muted" x-show="!historyLoading && history.length === 0">
                No history available for this snippet yet.
            </p>
            <p class="text-sm text-muted" x-show="historyLoading">
                Loading history...
            </p>
            <div class="history-list" x-show="!historyLoading && history.length > 0">
                <template x-for="(entry, index) in history" :key="entry.id">
                    <div class="history-entry">
                        <div class="history-entry-header">
                            <div>
                                <div class="history-entry-title" x-text="entry.title || 'Untitled'"></div>
                                <div class="history-entry-meta">
                                    <span x-text="formatDate(entry.created_at)"></span>
                                    <span x-show="entry.change_type === 'create'" class="badge">Created</span>
                                    <span x-show="entry.change_type === 'update'" class="badge">Updated</span>
                                    <span x-show="index === 0" class="badge badge-current">Current</span>
                                </div>
                            </div>
                            <div class="history-entry-actions">
                                <button class="btn-sm" @click="viewHistoryDetail(entry)">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                    View Full
                                </button>
                                <button class="btn-sm btn-primary" @click="confirmRestoreHistory(entry)"
                                    x-show="index > 0">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                                        <polyline points="1 4 1 10 7 10"></polyline>
                                        <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                                    </svg>
                                    Restore
                                </button>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </div>
</div>

<!-- History Detail modal -->
<div class="modal-backdrop" x-show="showHistoryDetail" x-cloak @click.self="closeHistoryDetail()">
    <div class="modal" style="max-width: 1000px; max-height: 85vh;">
        <div class="modal-header">
            <div>
                <h3 x-text="viewingHistoryEntry?.title || 'Untitled'"></h3>
                <p class="text-sm text-muted" style="margin-top: 0.25rem;">
                    <span x-text="formatDate(viewingHistoryEntry?.created_at)"></span>
                    <span x-show="viewingHistoryEntry?.change_type === 'create'"> â€¢ Created</span>
                    <span x-show="viewingHistoryEntry?.change_type === 'update'"> â€¢ Updated</span>
                </p>
            </div>
            <button class="btn-icon" @click="closeHistoryDetail()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="modal-body" style="overflow-y: auto; max-height: calc(85vh - 150px);">
            <div class="history-detail-section" x-show="viewingHistoryEntry?.description">
                <h4>Description</h4>
                <p x-text="viewingHistoryEntry?.description"></p>
            </div>

            <!-- Single file/content view -->
            <div class="history-detail-section" x-show="!viewingHistoryEntry?.files || viewingHistoryEntry?.files.length === 0">
                <h4>Content</h4>
                <div class="history-detail-content">
                    <div class="history-detail-file-header">
                        <span class="history-file-language" x-text="viewingHistoryEntry?.language || 'plaintext'"></span>
                        <button class="btn-sm" @click="copyHistoryContent(viewingHistoryEntry?.content)">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                            Copy
                        </button>
                    </div>
                    <pre class="history-detail-code"><code x-text="viewingHistoryEntry?.content"></code></pre>
                </div>
            </div>

            <!-- Multiple files view -->
            <div class="history-detail-section" x-show="viewingHistoryEntry?.files && viewingHistoryEntry?.files.length > 0">
                <h4>Files (<span x-text="viewingHistoryEntry?.files.length"></span>)</h4>
                <template x-for="(file, idx) in viewingHistoryEntry?.files" :key="file.id">
                    <div class="history-detail-content" style="margin-bottom: 1rem;">
                        <div class="history-detail-file-header">
                            <div>
                                <span class="history-file-name" x-text="file.filename"></span>
                                <span class="history-file-language" x-text="file.language"></span>
                            </div>
                            <button class="btn-sm" @click="copyHistoryContent(file.content)">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                </svg>
                                Copy
                            </button>
                        </div>
                        <pre class="history-detail-code"><code x-text="file.content"></code></pre>
                    </div>
                </template>
            </div>
        </div>
        <div class="modal-footer">
            <button @click="closeHistoryDetail()">Close</button>
            <button class="btn-primary" @click="confirmRestoreHistory(viewingHistoryEntry)"
                x-show="viewingHistoryEntry && !viewingHistoryEntry.is_current">
                Restore This Version
            </button>
        </div>
    </div>
</div>

<!-- Restore Confirmation modal -->
<div class="modal-backdrop" x-show="showRestoreConfirm" x-cloak @click.self="showRestoreConfirm = false">
    <div class="modal" style="max-width: 500px;">
        <div class="modal-header">
            <h3>Confirm Restore</h3>
            <button class="btn-icon" @click="showRestoreConfirm = false">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <div class="restore-warning">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="48" height="48" style="color: var(--snipo-warning);">
                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                    <line x1="12" y1="9" x2="12" y2="13"></line>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
            </div>
            <h4 style="text-align: center; margin: 1rem 0;">Restore Previous Version?</h4>
            <p style="text-align: center; color: var(--snipo-text-secondary); margin-bottom: 1rem;">
                This will restore the snippet to:
            </p>
            <div class="restore-info">
                <div class="restore-info-item">
                    <strong>Title:</strong> <span x-text="restoringHistoryEntry?.title"></span>
                </div>
                <div class="restore-info-item">
                    <strong>Version from:</strong> <span x-text="formatDate(restoringHistoryEntry?.created_at)"></span>
                </div>
                <div class="restore-info-item" x-show="restoringHistoryEntry?.files && restoringHistoryEntry.files.length > 0">
                    <strong>Files:</strong> <span x-text="restoringHistoryEntry?.files.length"></span>
                </div>
            </div>
            <div class="restore-notice">
                <strong>Important:</strong> The current version will be saved to history before restoring.
                You can always restore back to it later.
            </div>
        </div>
        <div class="modal-footer">
            <button @click="showRestoreConfirm = false">Cancel</button>
            <button class="btn-primary" @click="executeRestore()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                    <polyline points="1 4 1 10 7 10"></polyline>
                    <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                </svg>
                Restore Now
            </button>
        </div>
    </div>
</div>

<!-- Token Password Confirmation Modal (unified for create and delete) -->
<div x-show="tokenPasswordAction !== null" 
     class="modal-overlay" 
     style="z-index: 1001;"
     @click.self="cancelTokenPassword()"
     x-transition:enter="transition ease-out duration-200"
     x-transition:enter-start="opacity-0"
     x-transition:enter-end="opacity-100"
     x-transition:leave="transition ease-in duration-150"
     x-transition:leave-start="opacity-100"
     x-transition:leave-end="opacity-0">
    <div class="modal-dialog" 
         style="max-width: 440px;"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0 transform scale-95"
         x-transition:enter-end="opacity-100 transform scale-100"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100 transform scale-100"
         x-transition:leave-end="opacity-0 transform scale-95"
         @click.stop>
        <div class="modal-header" style="border-bottom: 1px solid var(--snipo-border);">
            <div style="display: flex; align-items: center; gap: 0.75rem;">
                <div :style="`width: 40px; height: 40px; border-radius: 50%; background: rgba(var(${tokenPasswordAction === 'delete' ? '--snipo-danger-rgb' : '--snipo-primary-rgb'}), 0.1); display: flex; align-items: center; justify-content: center;`">
                    <template x-if="tokenPasswordAction === 'delete'">
                        <svg viewBox="0 0 24 24" fill="none" stroke="var(--snipo-danger)" stroke-width="2" width="20" height="20">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                            <line x1="12" y1="9" x2="12" y2="13"></line>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                        </svg>
                    </template>
                    <template x-if="tokenPasswordAction === 'create'">
                        <svg viewBox="0 0 24 24" fill="none" stroke="var(--snipo-primary)" stroke-width="2" width="20" height="20">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                        </svg>
                    </template>
                </div>
                <h3 style="margin: 0; font-size: 1.125rem; font-weight: 600;" x-text="tokenPasswordAction === 'delete' ? 'Confirm Token Deletion' : 'Confirm Token Creation'"></h3>
            </div>
            <button class="btn-icon" @click="cancelTokenPassword()" style="margin-left: auto;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="modal-body" style="padding: 1.5rem;">
            <p style="margin-bottom: 1.25rem; color: var(--snipo-text-secondary); line-height: 1.6;" x-text="tokenPasswordAction === 'delete' ? 'For security, please enter your master password to confirm deletion of this API token. This action cannot be undone.' : 'For security, please enter your master password to create this API token.'"></p>
            <div class="editor-field" style="margin-bottom: 0;">
                <label style="font-weight: 500; margin-bottom: 0.5rem; display: block;">Master Password</label>
                <input type="password" 
                       x-model="tokenPassword" 
                       @keyup.enter="confirmTokenPassword()" 
                       placeholder="Enter your password"
                       style="width: 100%; padding: 0.625rem 0.875rem; border: 1px solid var(--snipo-border); border-radius: 6px; font-size: 0.9375rem;"
                       x-init="$nextTick(() => tokenPasswordAction !== null && $el.focus())">
            </div>
        </div>
        <div class="modal-footer" style="background: var(--snipo-bg-secondary); border-top: 1px solid var(--snipo-border); padding: 0.875rem 1.25rem; display: flex; gap: 0.625rem; justify-content: flex-end;">
            <button class="btn-secondary" 
                    @click="cancelTokenPassword()"
                    style="padding: 0.375rem 0.875rem; font-weight: 500; font-size: 0.875rem;">
                Cancel
            </button>
            <button :class="tokenPasswordAction === 'delete' ? 'btn-danger' : 'btn-primary'"
                    @click="confirmTokenPassword()"
                    style="padding: 0.375rem 0.875rem; font-weight: 500; font-size: 0.875rem; display: flex; align-items: center; gap: 0.375rem;">
                <template x-if="tokenPasswordAction === 'delete'">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                </template>
                <template x-if="tokenPasswordAction === 'create'">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                        <path d="M12 5v14M5 12h14"></path>
                    </svg>
                </template>
                <span x-text="tokenPasswordAction === 'delete' ? 'Delete Token' : 'Create Token'"></span>
            </button>
        </div>
    </div>
</div>

<!-- Font Size Help Modal -->
<div class="modal-backdrop" x-show="showFontSizeHelp" x-cloak @click.self="showFontSizeHelp = false">
    <div class="modal" style="max-width: 600px;">
        <div class="modal-header">
            <h3>Browser Minimum Font Size Settings</h3>
            <button class="btn-icon" @click="showFontSizeHelp = false">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
            <p style="margin-bottom: 1.5rem; color: var(--pico-muted-color);">
                If font sizes below 14px aren't displaying correctly, your browser may have a minimum font size setting enabled. Here's how to change it:
            </p>

            <!-- Firefox -->
            <div style="margin-bottom: 2rem;">
                <h4 style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                        <circle cx="12" cy="12" r="10"></circle>
                        <circle cx="12" cy="12" r="6"></circle>
                        <circle cx="12" cy="12" r="2"></circle>
                    </svg>
                    Firefox
                </h4>
                <ol style="margin-left: 1.5rem; line-height: 1.8;">
                    <li>Type <code style="background: var(--pico-card-background-color); padding: 0.125rem 0.375rem; border-radius: 3px; font-size: 0.875rem;">about:config</code> in the address bar and press Enter</li>
                    <li>Accept the warning message</li>
                    <li>Search for <code style="background: var(--pico-card-background-color); padding: 0.125rem 0.375rem; border-radius: 3px; font-size: 0.875rem;">font.minimum-size</code></li>
                    <li>Find <code style="background: var(--pico-card-background-color); padding: 0.125rem 0.375rem; border-radius: 3px; font-size: 0.875rem;">font.minimum-size.x-western</code> (or your language variant)</li>
                    <li>Double-click and set the value to <strong>0</strong> (or a lower value like 8)</li>
                    <li>Restart Firefox for changes to take effect</li>
                </ol>
            </div>

            <!-- Chrome -->
            <div style="margin-bottom: 2rem;">
                <h4 style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M12 2a10 10 0 0 0 0 20"></path>
                    </svg>
                    Chrome / Edge
                </h4>
                <ol style="margin-left: 1.5rem; line-height: 1.8;">
                    <li>Open Settings (â‹® menu â†’ Settings)</li>
                    <li>Click <strong>Appearance</strong> in the left sidebar</li>
                    <li>Click <strong>Customize fonts</strong></li>
                    <li>Find <strong>Minimum font size</strong> slider</li>
                    <li>Set it to the smallest value or adjust as needed</li>
                    <li>Close the settings tab</li>
                </ol>
            </div>

            <!-- Safari -->
            <div style="margin-bottom: 1rem;">
                <h4 style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M12 2v20M2 12h20"></path>
                    </svg>
                    Safari
                </h4>
                <ol style="margin-left: 1.5rem; line-height: 1.8;">
                    <li>Open Safari â†’ Preferences (or Settings on newer versions)</li>
                    <li>Go to the <strong>Appearance</strong> tab</li>
                    <li>Uncheck <strong>"Never use font sizes smaller than"</strong></li>
                    <li>Or adjust the dropdown to a smaller value</li>
                    <li>Close the preferences window</li>
                </ol>
            </div>

            <div style="background: var(--pico-card-background-color); padding: 1rem; border-radius: 6px; border-left: 3px solid var(--snipo-primary); margin-top: 1.5rem;">
                <p style="margin: 0; font-size: 0.875rem; color: var(--pico-muted-color);">
                    <strong>Note:</strong> These settings are browser-level accessibility features designed to help users with visual impairments. Websites cannot override them by design.
                </p>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-primary" @click="showFontSizeHelp = false">Got it</button>
        </div>
    </div>
</div>
{{end}}