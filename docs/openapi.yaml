openapi: 3.1.0
info:
  title: Snipo API
  description: |
    REST API for Snipo - a lightweight, self-hosted snippet manager.
    
    ## Authentication
    
    All protected endpoints require authentication via one of:
    - **Session Cookie**: `snipo_session` cookie (for web UI)
    - **Bearer Token**: `Authorization: Bearer <token>` header
    - **API Key**: `X-API-Key: <key>` header
    
    API tokens can be created via the Settings page or `/api/v1/tokens` endpoint.
    
    ### Token Permissions
    
    API tokens have permission levels that control access:
    - **read**: Can only access GET endpoints (view snippets, tags, folders)
    - **write**: Can create, update, and delete snippets, tags, and folders
    - **admin**: Full access including token management, settings, and backups
    
    Session-based auth (web UI) has full admin access by default.
    
    ## Rate Limiting
    
    API endpoints are rate-limited based on permission level:
    - **Read operations**: 1000 requests/hour (configurable via `SNIPO_RATE_LIMIT_READ`)
    - **Write operations**: 500 requests/hour (configurable via `SNIPO_RATE_LIMIT_WRITE`)
    - **Admin operations**: 100 requests/hour (configurable via `SNIPO_RATE_LIMIT_ADMIN`)
    
    Rate limit information is included in response headers:
    - `X-RateLimit-Limit`: Maximum requests per window
    - `X-RateLimit-Remaining`: Requests remaining in current window
    - `X-RateLimit-Reset`: Unix timestamp when the limit resets
    - `Retry-After`: Seconds to wait before retrying (when limit exceeded)
    
    ## Response Format
    
    All API responses use a standardized envelope format:
    
    **Single Resource:**
    ```json
    {
      "data": {...},
      "meta": {
        "request_id": "uuid",
        "timestamp": "2024-12-24T10:30:00Z",
        "version": "1.0"
      }
    }
    ```
    
    **List with Pagination:**
    ```json
    {
      "data": [...],
      "pagination": {
        "page": 1,
        "limit": 20,
        "total": 150,
        "total_pages": 8,
        "links": {
          "self": "/api/v1/snippets?page=1&limit=20",
          "next": "/api/v1/snippets?page=2&limit=20",
          "prev": null
        }
      },
      "meta": {
        "request_id": "uuid",
        "timestamp": "2024-12-24T10:30:00Z",
        "version": "1.0"
      }
    }
    ```
    
    ## Request Tracking
    
    Every request is assigned a unique `request_id` (UUID v4) for tracking and debugging.
    The ID is returned in:
    - Response header: `X-Request-ID`
    - Response body: `meta.request_id`
    
    ## Configuration
    
    The API supports configuration via environment variables:
    - `SNIPO_ALLOWED_ORIGINS`: CORS allowed origins (comma-separated)
    - `SNIPO_RATE_LIMIT_READ/WRITE/ADMIN`: Custom rate limits
    - `SNIPO_ENABLE_PUBLIC_SNIPPETS`: Enable/disable public snippet sharing
    - `SNIPO_ENABLE_API_TOKENS`: Enable/disable API token creation
    - `SNIPO_ENABLE_BACKUP_RESTORE`: Enable/disable backup/restore features
    
    Feature flags are exposed via `/health` endpoint.
  version: 1.0.0
  license:
    name: GPL-3.0
    url: https://www.gnu.org/licenses/gpl-3.0.html
  contact:
    name: Mohamed Elashri 
    url: https://github.com/MohamedElashri/snipo

servers:
  - url: http://localhost:8080
    description: Local development server

tags:
  - name: Health
    description: Health check endpoints
  - name: Authentication
    description: Login, logout, and session management
  - name: Snippets
    description: Code snippet CRUD operations
  - name: Tags
    description: Tag management
  - name: Folders
    description: Folder organization
  - name: Tokens
    description: API token management
  - name: Backup
    description: Backup and restore operations
  - name: Settings
    description: Application settings management (admin only)
  - name: GitHub Gist Sync
    description: Two-way synchronization with GitHub Gists
  - name: Documentation
    description: API documentation and specifications

paths:
  /ping:
    get:
      tags: [Health]
      summary: Liveness check
      description: Simple liveness check that returns "pong"
      operationId: ping
      responses:
        '200':
          description: Service is alive
          content:
            text/plain:
              schema:
                type: string
                examples:
                  - pong

  /health:
    get:
      tags: [Health]
      summary: Health check
      description: Returns health status including database connectivity and version info
      operationId: health
      responses:
        '200':
          description: Health status - all checks passed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              examples:
                healthy:
                  summary: All systems healthy
                  value:
                    status: "healthy"
                    version: "1.0.0"
                    commit: "abc123"
                    uptime: "2h30m15s"
                    checks:
                      database: "healthy"
                    memory:
                      alloc_mb: 45
                      total_alloc_mb: 120
                      sys_mb: 75
                      num_gc: 12
                    features:
                      public_snippets: true
                      s3_sync: false
                      api_tokens: true
                      backup_restore: true
                    timestamp: "2024-01-07T00:00:00Z"
        '503':
          description: Service unhealthy - database connection failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              examples:
                database_unhealthy:
                  summary: Database connection failed
                  value:
                    status: "unhealthy"
                    version: "1.0.0"
                    uptime: "2h30m15s"
                    checks:
                      database: "unhealthy: connection refused"
                    memory:
                      alloc_mb: 45
                      total_alloc_mb: 120
                      sys_mb: 75
                      num_gc: 12
                    timestamp: "2024-01-07T00:00:00Z"

  /api/v1/auth/login:
    post:
      tags: [Authentication]
      summary: Login
      description: Authenticate with password and receive a session cookie
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          headers:
            Set-Cookie:
              schema:
                type: string
                examples:
                  - snipo_session=abc123; Path=/; HttpOnly; SameSite=Lax
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
              examples:
                success:
                  summary: Login successful
                  value:
                    success: true
                    message: "Login successful"
        '400':
          description: Bad request - invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_json:
                  summary: Invalid JSON payload
                  value:
                    error:
                      code: "INVALID_JSON"
                      message: "Invalid JSON payload"
                missing_password:
                  summary: Password field missing
                  value:
                    error:
                      code: "MISSING_PASSWORD"
                      message: "Password is required"
        '401':
          description: Unauthorized - invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_credentials:
                  summary: Invalid password
                  value:
                    error:
                      code: "INVALID_CREDENTIALS"
                      message: "Invalid password"
        '429':
          description: Too many failed login attempts
          headers:
            Retry-After:
              description: Seconds to wait before retrying
              schema:
                type: integer
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                rate_limited:
                  summary: Too many failed attempts
                  value:
                    error:
                      code: "RATE_LIMITED"
                      message: "Too many failed attempts. Please wait 60 seconds."
        '500':
          description: Internal server error - session creation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                session_creation_failed:
                  summary: Failed to create session
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

  /api/v1/auth/logout:
    post:
      tags: [Authentication]
      summary: Logout
      description: Invalidate current session and clear session cookie
      operationId: logout
      responses:
        '200':
          description: Logout successful
          headers:
            Set-Cookie:
              description: Clears the session cookie
              schema:
                type: string
                examples:
                  - snipo_session=; Path=/; Max-Age=0
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
              examples:
                success:
                  summary: Logout successful
                  value:
                    success: true
                    message: "Logout successful"

  /api/v1/auth/check:
    get:
      tags: [Authentication]
      summary: Check authentication status
      description: Verify if current session is valid
      operationId: authCheck
      responses:
        '200':
          description: Authenticated
          content:
            application/json:
              schema:
                type: object
                properties:
                  authenticated:
                    type: boolean
              examples:
                authenticated:
                  summary: Valid session
                  value:
                    authenticated: true
        '401':
          description: Unauthorized - no valid session
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_session:
                  summary: No session token provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_session:
                  summary: Invalid or expired session
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"

  /api/v1/auth/change-password:
    post:
      tags: [Authentication]
      summary: Change password
      description: Update the application password
      operationId: changePassword
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangePasswordRequest'
      responses:
        '200':
          description: Password changed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
              examples:
                success:
                  summary: Password changed
                  value:
                    success: true
                    message: "Password changed successfully"
        '400':
          description: Bad request - validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_json:
                  summary: Invalid JSON payload
                  value:
                    error:
                      code: "INVALID_JSON"
                      message: "Invalid JSON payload"
                missing_fields:
                  summary: Required fields missing
                  value:
                    error:
                      code: "MISSING_FIELDS"
                      message: "Current and new password are required"
                password_too_short:
                  summary: New password too short
                  value:
                    error:
                      code: "PASSWORD_TOO_SHORT"
                      message: "Password must be at least 12 characters"
        '401':
          description: Unauthorized - invalid current password
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_password:
                  summary: Current password incorrect
                  value:
                    error:
                      code: "INVALID_PASSWORD"
                      message: "Current password is incorrect"
        '403':
          description: Forbidden - demo mode restriction
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                demo_mode:
                  summary: Password changes disabled in demo mode
                  value:
                    error:
                      code: "DEMO_MODE_RESTRICTION"
                      message: "Password changes are disabled in demo mode"
        '500':
          description: Internal server error - password update failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                password_update_failed:
                  summary: Failed to update password
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

  /api/v1/snippets:
    get:
      tags: [Snippets]
      summary: List snippets
      description: Get paginated list of snippets with optional filtering
      operationId: listSnippets
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - name: q
          in: query
          description: |
            Search query (fuzzy search). Searches across snippet titles, descriptions, 
            content, file contents, and filenames. Multiple words are matched with AND logic.
          schema:
            type: string
          example: "python docker"
        - name: language
          in: query
          description: Filter by programming language
          schema:
            type: string
          example: "javascript"
        - name: favorite
          in: query
          description: Filter by favorite status
          schema:
            type: boolean
        - name: tag_id
          in: query
          description: Filter by single tag ID (deprecated, use tag_ids for multiple)
          schema:
            type: integer
          example: 1
        - name: tag_ids
          in: query
          description: Filter by multiple tag IDs (comma-separated)
          schema:
            type: string
          example: "1,2,3"
        - name: folder_id
          in: query
          description: Filter by single folder ID (deprecated, use folder_ids for multiple)
          schema:
            type: integer
          example: 1
        - name: folder_ids
          in: query
          description: Filter by multiple folder IDs (comma-separated)
          schema:
            type: string
          example: "1,2"
        - name: is_archived
          in: query
          description: Filter by archived status (default is false)
          schema:
            type: boolean
          example: false
        - name: sort
          in: query
          description: Sort field
          schema:
            type: string
            enum: [created_at, updated_at, title]
            default: updated_at
        - name: order
          in: query
          description: Sort order
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        '200':
          description: List of snippets with pagination
          headers:
            X-Request-ID:
              description: Unique request identifier
              schema:
                type: string
                format: uuid
            X-API-Version:
              description: API version
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SnippetListResponse'
              examples:
                paginated_list:
                  summary: Paginated list of snippets
                  value:
                    data:
                      - id: 1
                        title: "HTTP Server in Go"
                        language: "go"
                        is_public: false
                        is_archived: false
                        folder_id: 2
                        tags: ["golang", "http", "server"]
                        created_at: "2024-12-20T10:00:00Z"
                        updated_at: "2024-12-20T10:00:00Z"
                      - id: 2
                        title: "Database Query Helper"
                        language: "python"
                        is_public: true
                        is_archived: false
                        folder_id: 2
                        tags: ["python", "database"]
                        created_at: "2024-12-21T14:30:00Z"
                        updated_at: "2024-12-21T14:30:00Z"
                    pagination:
                      page: 1
                      limit: 20
                      total: 45
                      total_pages: 3
                      links:
                        self: "/api/v1/snippets?page=1&limit=20"
                        next: "/api/v1/snippets?page=2&limit=20"
                        prev: null
                    meta:
                      request_id: "550e8400-e29b-41d4-a716-446655440000"
                      timestamp: "2024-12-24T10:30:00Z"
                      version: "1.0"
                filtered_by_tag:
                  summary: Filtered by tag
                  value:
                    data:
                      - id: 1
                        title: "HTTP Server in Go"
                        language: "go"
                        is_public: false
                        is_archived: false
                        tags: ["golang", "http", "server"]
                        created_at: "2024-12-20T10:00:00Z"
                        updated_at: "2024-12-20T10:00:00Z"
                    pagination:
                      page: 1
                      limit: 20
                      total: 1
                      total_pages: 1
                      links:
                        self: "/api/v1/snippets?tag=golang&page=1&limit=20"
                        next: null
                        prev: null
                    meta:
                      request_id: "550e8400-e29b-41d4-a716-446655440000"
                      timestamp: "2024-12-21T15:00:00Z"
                      version: "1.0"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Read permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error - database query failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to retrieve snippets
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

    post:
      tags: [Snippets]
      summary: Create snippet
      description: Create a new code snippet
      operationId: createSnippet
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SnippetInput'
            examples:
              basic:
                summary: Basic snippet
                value:
                  title: "Hello World"
                  content: |
                    package main
                    
                    import "fmt"
                    
                    func main() {
                        fmt.Println("Hello, World!")
                    }
                  language: "go"
                  description: "Simple Go hello world program"
              with_tags_and_folder:
                summary: Snippet with tags and folder
                value:
                  title: "Database Connection Pool"
                  content: |
                    import psycopg2.pool
                    
                    pool = psycopg2.pool.SimpleConnectionPool(
                        minconn=1,
                        maxconn=20,
                        host='localhost',
                        database='mydb',
                        user='user',
                        password='pass'
                    )
                  language: "python"
                  description: "PostgreSQL connection pool setup"
                  tags: ["database", "postgresql", "python"]
                  folder_id: 5
                  is_public: false
      responses:
        '201':
          description: Snippet created successfully
          headers:
            X-Request-ID:
              description: Unique request identifier
              schema:
                type: string
                format: uuid
            X-API-Version:
              description: API version
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIResponse'
              examples:
                success:
                  summary: Successful creation
                  value:
                    data:
                      id: 42
                      title: "Hello World"
                      content: |
                        package main
                        
                        import "fmt"
                        
                        func main() {
                            fmt.Println("Hello, World!")
                        }
                      language: "go"
                      description: "Simple Go hello world program"
                      is_public: false
                      is_archived: false
                      folder_id: null
                      tags: []
                      created_at: "2024-12-24T10:30:00Z"
                      updated_at: "2024-12-24T10:30:00Z"
                    meta:
                      request_id: "550e8400-e29b-41d4-a716-446655440000"
                      timestamp: "2024-12-24T10:30:00Z"
                      version: "1.0"
        '400':
          description: Bad request - invalid JSON
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_json:
                  summary: Invalid JSON payload
                  value:
                    error:
                      code: "INVALID_JSON"
                      message: "Invalid JSON payload"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Write permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error - failed to create snippet
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                creation_failed:
                  summary: Database error during creation
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
              examples:
                empty_title:
                  summary: Empty title validation error
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "title"
                          message: "Title must not be empty"
                multiple_errors:
                  summary: Multiple validation errors
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "title"
                          message: "Title must not be empty"
                        - field: "language"
                          message: "Unsupported language: 'invalid_lang'"
                        - field: "folder_id"
                          message: "Folder with ID 999 not found"

  /api/v1/snippets/search:
    get:
      tags: [Snippets]
      summary: Full-text search
      description: Search snippets using full-text search
      operationId: searchSnippets
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: q
          in: query
          required: true
          description: Search query
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Snippet'
              examples:
                results:
                  summary: Search results
                  value:
                    data:
                      - id: "abc123"
                        title: "Python HTTP Server"
                        language: "python"
                        is_public: false
                empty_query:
                  summary: Empty query returns empty array
                  value:
                    data: []
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Read permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error - search failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                search_failed:
                  summary: Database search error
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

  /api/v1/snippets/public/{id}:
    get:
      tags: [Snippets]
      summary: Get public snippet
      description: Get a public snippet without authentication
      operationId: getPublicSnippet
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Public snippet
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Snippet'
        '400':
          description: Bad request - missing ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missing_id:
                  summary: Snippet ID is required
                  value:
                    error:
                      code: "MISSING_ID"
                      message: "Snippet ID is required"
        '404':
          description: Snippet not found or not public
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                not_found:
                  summary: Snippet not found
                  value:
                    error:
                      code: "NOT_FOUND"
                      message: "Snippet not found"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to retrieve snippet
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

  /api/v1/snippets/public/{id}/files/{filename}:
    get:
      tags: [Snippets]
      summary: Get public snippet file
      description: |
        Get raw content of a specific file from a public multi-file snippet.
        Returns plain text content suitable for downloading via wget/curl.
        This endpoint is useful for accessing individual files in multi-file snippets.
      operationId: getPublicSnippetFile
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Snippet ID
        - name: filename
          in: path
          required: true
          schema:
            type: string
          description: Name of the file to retrieve
      responses:
        '200':
          description: Raw file content
          content:
            text/plain:
              schema:
                type: string
          headers:
            Content-Disposition:
              schema:
                type: string
              description: 'inline; filename="<filename>"'
        '400':
          description: Bad request - missing ID or filename
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missing_id:
                  summary: Snippet ID is required
                  value:
                    error:
                      code: "MISSING_ID"
                      message: "Snippet ID is required"
                missing_filename:
                  summary: Filename is required
                  value:
                    error:
                      code: "MISSING_FILENAME"
                      message: "Filename is required"
        '404':
          description: Snippet or file not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                snippet_not_found:
                  summary: Snippet not found
                  value:
                    error:
                      code: "NOT_FOUND"
                      message: "File not found"
                file_not_found:
                  summary: File not found in snippet
                  value:
                    error:
                      code: "NOT_FOUND"
                      message: "File not found in snippet"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to retrieve snippet
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

  /api/v1/snippets/{id}:
    get:
      tags: [Snippets]
      summary: Get snippet
      description: Get a single snippet by ID
      operationId: getSnippet
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Snippet details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Snippet'
        '400':
          description: Bad request - missing ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missing_id:
                  summary: Snippet ID is required
                  value:
                    error:
                      code: "MISSING_ID"
                      message: "Snippet ID is required"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Read permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '404':
          description: Snippet not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                not_found:
                  summary: Snippet not found
                  value:
                    error:
                      code: "NOT_FOUND"
                      message: "Snippet not found"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to retrieve snippet
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

    put:
      tags: [Snippets]
      summary: Update snippet
      description: Update an existing snippet
      operationId: updateSnippet
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SnippetInput'
      responses:
        '200':
          description: Snippet updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Snippet'
        '400':
          description: Bad request - missing ID or invalid JSON
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missing_id:
                  summary: Snippet ID is required
                  value:
                    error:
                      code: "MISSING_ID"
                      message: "Snippet ID is required"
                invalid_json:
                  summary: Invalid JSON payload
                  value:
                    error:
                      code: "INVALID_JSON"
                      message: "Invalid JSON payload"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Write permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '404':
          description: Snippet not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                not_found:
                  summary: Snippet not found
                  value:
                    error:
                      code: "NOT_FOUND"
                      message: "Snippet not found"
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          description: Internal server error - update failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                update_failed:
                  summary: Database error during update
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

    delete:
      tags: [Snippets]
      summary: Delete snippet
      description: Delete a snippet
      operationId: deleteSnippet
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Snippet deleted successfully
        '400':
          description: Bad request - missing ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missing_id:
                  summary: Snippet ID is required
                  value:
                    error:
                      code: "MISSING_ID"
                      message: "Snippet ID is required"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Write permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '404':
          description: Snippet not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                not_found:
                  summary: Snippet not found
                  value:
                    error:
                      code: "NOT_FOUND"
                      message: "Snippet not found"
        '500':
          description: Internal server error - deletion failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                deletion_failed:
                  summary: Database error during deletion
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

  /api/v1/snippets/{id}/favorite:
    post:
      tags: [Snippets]
      summary: Toggle favorite
      description: Toggle the favorite status of a snippet
      operationId: toggleFavorite
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Favorite toggled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Snippet'
        '400':
          description: Bad request - missing ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missing_id:
                  summary: Snippet ID is required
                  value:
                    error:
                      code: "MISSING_ID"
                      message: "Snippet ID is required"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Write permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '404':
          description: Snippet not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                not_found:
                  summary: Snippet not found
                  value:
                    error:
                      code: "NOT_FOUND"
                      message: "Snippet not found"
        '500':
          description: Internal server error - toggle failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                toggle_failed:
                  summary: Database error during toggle
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

  /api/v1/snippets/{id}/duplicate:
    post:
      tags: [Snippets]
      summary: Duplicate snippet
      description: Create a copy of an existing snippet
      operationId: duplicateSnippet
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '201':
          description: Snippet duplicated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Snippet'
        '400':
          description: Bad request - missing ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missing_id:
                  summary: Snippet ID is required
                  value:
                    error:
                      code: "MISSING_ID"
                      message: "Snippet ID is required"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Write permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '404':
          description: Snippet not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                not_found:
                  summary: Snippet not found
                  value:
                    error:
                      code: "NOT_FOUND"
                      message: "Snippet not found"
        '500':
          description: Internal server error - duplication failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                duplication_failed:
                  summary: Database error during duplication
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

  /api/v1/snippets/{id}/archive:
    post:
      tags: [Snippets]
      summary: Archive snippet
      description: |
        Archive a snippet (hide from main list).
        Requires write or admin permission.
      operationId: archiveSnippet
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Snippet ID
      responses:
        '200':
          description: Snippet archived successfully
          headers:
            X-Request-ID:
              schema:
                type: string
                format: uuid
              description: Unique request identifier
            X-API-Version:
              schema:
                type: string
              description: API version
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Snippet'
                  meta:
                    $ref: '#/components/schemas/Meta'
        '400':
          description: Bad request - missing ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missing_id:
                  summary: Snippet ID is required
                  value:
                    error:
                      code: "MISSING_ID"
                      message: "Snippet ID is required"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Write permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '404':
          description: Snippet not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                not_found:
                  summary: Snippet not found
                  value:
                    error:
                      code: "NOT_FOUND"
                      message: "Snippet not found"
        '500':
          description: Internal server error - archive failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                archive_failed:
                  summary: Database error during archive
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

  /api/v1/snippets/{id}/history:
    get:
      tags: [Snippets]
      summary: Get snippet history
      description: |
        Retrieve version history for a snippet.
        Requires read, write, or admin permission.
      operationId: getSnippetHistory
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Snippet ID
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 50
          description: Maximum number of history entries to return
      responses:
        '200':
          description: Snippet history retrieved successfully
          headers:
            X-Request-ID:
              schema:
                type: string
                format: uuid
            X-API-Version:
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/HistoryEntry'
                  meta:
                    $ref: '#/components/schemas/Meta'
        '400':
          description: Bad request - missing ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missing_id:
                  summary: Snippet ID is required
                  value:
                    error:
                      code: "MISSING_ID"
                      message: "Snippet ID is required"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Read permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '404':
          description: Snippet not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                not_found:
                  summary: Snippet not found
                  value:
                    error:
                      code: "NOT_FOUND"
                      message: "Snippet not found"
        '500':
          description: Internal server error - failed to retrieve history
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                history_failed:
                  summary: Database error retrieving history
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

  /api/v1/snippets/{id}/history/{history_id}/restore:
    post:
      tags: [Snippets]
      summary: Restore from history
      description: |
        Restore a snippet to a previous version from history.
        Requires write or admin permission.
      operationId: restoreSnippetHistory
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Snippet ID
        - name: history_id
          in: path
          required: true
          schema:
            type: string
          description: History entry ID to restore from
      responses:
        '200':
          description: Snippet restored successfully
          headers:
            X-Request-ID:
              schema:
                type: string
                format: uuid
            X-API-Version:
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Snippet'
                  meta:
                    $ref: '#/components/schemas/Meta'
        '400':
          description: Bad request - missing or invalid IDs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missing_id:
                  summary: Snippet ID is required
                  value:
                    error:
                      code: "MISSING_ID"
                      message: "Snippet ID is required"
                missing_history_id:
                  summary: History ID is required
                  value:
                    error:
                      code: "MISSING_HISTORY_ID"
                      message: "History ID is required"
                invalid_history_id:
                  summary: Invalid history ID format
                  value:
                    error:
                      code: "INVALID_HISTORY_ID"
                      message: "Invalid history ID"
                restore_failed:
                  summary: Restore operation failed
                  value:
                    error:
                      code: "RESTORE_FAILED"
                      message: "History entry not found"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Write permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '404':
          description: Snippet not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                not_found:
                  summary: Snippet not found
                  value:
                    error:
                      code: "NOT_FOUND"
                      message: "Snippet not found"

  /api/v1/tags:
    get:
      tags: [Tags]
      summary: List tags
      description: Get all tags with snippet counts
      operationId: listTags
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      responses:
        '200':
          description: List of tags
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Tag'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Read permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to retrieve tags
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

    post:
      tags: [Tags]
      summary: Create tag
      description: Create a new tag
      operationId: createTag
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TagInput'
      responses:
        '201':
          description: Tag created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tag'
        '400':
          description: Bad request - invalid JSON or validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_json:
                  summary: Invalid JSON payload
                  value:
                    error:
                      code: "INVALID_JSON"
                      message: "Invalid JSON payload"
                name_required:
                  summary: Name is required
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "name"
                          message: "Name is required"
                name_too_long:
                  summary: Name exceeds maximum length
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "name"
                          message: "Name must be 50 characters or less"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Write permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '409':
          description: Tag already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                tag_exists:
                  summary: Tag name already exists
                  value:
                    error:
                      code: "TAG_EXISTS"
                      message: "A tag with this name already exists"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to create tag
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

  /api/v1/tags/{id}:
    get:
      tags: [Tags]
      summary: Get tag
      description: Get a single tag by ID
      operationId: getTag
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Tag details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tag'
        '400':
          description: Bad request - invalid ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_id:
                  summary: Invalid tag ID
                  value:
                    error:
                      code: "INVALID_ID"
                      message: "Invalid tag ID"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Read permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '404':
          description: Tag not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                not_found:
                  summary: Tag not found
                  value:
                    error:
                      code: "NOT_FOUND"
                      message: "Tag not found"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to retrieve tag
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

    put:
      tags: [Tags]
      summary: Update tag
      description: Update an existing tag
      operationId: updateTag
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TagInput'
      responses:
        '200':
          description: Tag updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tag'
        '400':
          description: Bad request - invalid ID, JSON, or validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_id:
                  summary: Invalid tag ID
                  value:
                    error:
                      code: "INVALID_ID"
                      message: "Invalid tag ID"
                invalid_json:
                  summary: Invalid JSON payload
                  value:
                    error:
                      code: "INVALID_JSON"
                      message: "Invalid JSON payload"
                name_required:
                  summary: Name is required
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "name"
                          message: "Name is required"
                name_too_long:
                  summary: Name exceeds maximum length
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "name"
                          message: "Name must be 50 characters or less"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Write permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '404':
          description: Tag not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                not_found:
                  summary: Tag not found
                  value:
                    error:
                      code: "NOT_FOUND"
                      message: "Tag not found"
        '409':
          description: Tag name already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                tag_exists:
                  summary: Tag name already exists
                  value:
                    error:
                      code: "TAG_EXISTS"
                      message: "A tag with this name already exists"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to update tag
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

    delete:
      tags: [Tags]
      summary: Delete tag
      description: Delete a tag
      operationId: deleteTag
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Tag deleted
        '400':
          description: Bad request - invalid ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_id:
                  summary: Invalid tag ID
                  value:
                    error:
                      code: "INVALID_ID"
                      message: "Invalid tag ID"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Write permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '404':
          description: Tag not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                not_found:
                  summary: Tag not found
                  value:
                    error:
                      code: "NOT_FOUND"
                      message: "Tag not found"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to delete tag
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

  /api/v1/folders:
    get:
      tags: [Folders]
      summary: List folders
      description: Get all folders, optionally as a tree structure
      operationId: listFolders
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: tree
          in: query
          description: Return as nested tree structure
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: List of folders
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Folder'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Read permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to retrieve folders
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

    post:
      tags: [Folders]
      summary: Create folder
      description: Create a new folder
      operationId: createFolder
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FolderInput'
      responses:
        '201':
          description: Folder created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Folder'
        '400':
          description: Bad request - invalid JSON or validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_json:
                  summary: Invalid JSON payload
                  value:
                    error:
                      code: "INVALID_JSON"
                      message: "Invalid JSON payload"
                name_required:
                  summary: Name is required
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "name"
                          message: "Name is required"
                name_too_long:
                  summary: Name exceeds maximum length
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "name"
                          message: "Name must be 100 characters or less"
                parent_not_found:
                  summary: Parent folder not found
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "parent_id"
                          message: "Parent folder not found"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Write permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to create folder
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

  /api/v1/folders/{id}:
    get:
      tags: [Folders]
      summary: Get folder
      description: Get a single folder by ID
      operationId: getFolder
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Folder details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Folder'
        '400':
          description: Bad request - invalid ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_id:
                  summary: Invalid folder ID
                  value:
                    error:
                      code: "INVALID_ID"
                      message: "Invalid folder ID"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Read permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '404':
          description: Folder not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                not_found:
                  summary: Folder not found
                  value:
                    error:
                      code: "NOT_FOUND"
                      message: "Folder not found"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to retrieve folder
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

    put:
      tags: [Folders]
      summary: Update folder
      description: Update an existing folder
      operationId: updateFolder
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FolderInput'
      responses:
        '200':
          description: Folder updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Folder'
        '400':
          description: Bad request - invalid ID, JSON, or validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_id:
                  summary: Invalid folder ID
                  value:
                    error:
                      code: "INVALID_ID"
                      message: "Invalid folder ID"
                invalid_json:
                  summary: Invalid JSON payload
                  value:
                    error:
                      code: "INVALID_JSON"
                      message: "Invalid JSON payload"
                name_required:
                  summary: Name is required
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "name"
                          message: "Name is required"
                name_too_long:
                  summary: Name exceeds maximum length
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "name"
                          message: "Name must be 100 characters or less"
                self_parent:
                  summary: Folder cannot be its own parent
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "parent_id"
                          message: "Folder cannot be its own parent"
                parent_not_found:
                  summary: Parent folder not found
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "parent_id"
                          message: "Parent folder not found"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Write permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '404':
          description: Folder not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                not_found:
                  summary: Folder not found
                  value:
                    error:
                      code: "NOT_FOUND"
                      message: "Folder not found"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to update folder
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

    delete:
      tags: [Folders]
      summary: Delete folder
      description: Delete a folder (cascades to child folders)
      operationId: deleteFolder
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Folder deleted
        '400':
          description: Bad request - invalid ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_id:
                  summary: Invalid folder ID
                  value:
                    error:
                      code: "INVALID_ID"
                      message: "Invalid folder ID"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Write permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '404':
          description: Folder not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                not_found:
                  summary: Folder not found
                  value:
                    error:
                      code: "NOT_FOUND"
                      message: "Folder not found"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to delete folder
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

  /api/v1/folders/{id}/move:
    put:
      tags: [Folders]
      summary: Move folder
      description: Move a folder to a new parent
      operationId: moveFolder
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                parent_id:
                  type: [integer, "null"]
                  description: New parent folder ID (null for root)
      responses:
        '200':
          description: Folder moved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Folder'
        '400':
          description: Bad request - invalid ID, JSON, or validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_id:
                  summary: Invalid folder ID
                  value:
                    error:
                      code: "INVALID_ID"
                      message: "Invalid folder ID"
                invalid_json:
                  summary: Invalid JSON payload
                  value:
                    error:
                      code: "INVALID_JSON"
                      message: "Invalid JSON payload"
                self_parent:
                  summary: Folder cannot be its own parent
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "parent_id"
                          message: "Folder cannot be its own parent"
                parent_not_found:
                  summary: Parent folder not found
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "parent_id"
                          message: "Parent folder not found"
                circular_reference:
                  summary: Would create circular reference
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "parent_id"
                          message: "Cannot move folder: would create circular reference"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Write permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '404':
          description: Folder not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                not_found:
                  summary: Folder not found
                  value:
                    error:
                      code: "NOT_FOUND"
                      message: "Folder not found"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to move folder
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

  /api/v1/tokens:
    get:
      tags: [Tokens]
      summary: List API tokens
      description: Get all API tokens (without the actual token values)
      operationId: listTokens
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      responses:
        '200':
          description: List of tokens
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/APIToken'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - admin permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Admin permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to retrieve tokens
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

    post:
      tags: [Tokens]
      summary: Create API token
      description: Create a new API token. The token value is only returned once.
      operationId: createToken
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/APITokenInput'
      responses:
        '201':
          description: Token created (includes the token value)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIToken'
        '400':
          description: Bad request - invalid JSON or validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_json:
                  summary: Invalid JSON payload
                  value:
                    error:
                      code: "INVALID_JSON"
                      message: "Invalid JSON payload"
                name_required:
                  summary: Name is required
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "name"
                          message: "Name is required"
                name_too_long:
                  summary: Name exceeds maximum length
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "name"
                          message: "Name must be 100 characters or less"
                invalid_permissions:
                  summary: Invalid permissions value
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "permissions"
                          message: "Permissions must be 'read', 'write', or 'admin'"
        '401':
          description: Unauthorized - password required or invalid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
                password_required:
                  summary: Password required for token creation
                  value:
                    error:
                      code: "PASSWORD_REQUIRED"
                      message: "Password is required to create API tokens"
                invalid_password:
                  summary: Invalid password
                  value:
                    error:
                      code: "INVALID_PASSWORD"
                      message: "Invalid password"
        '403':
          description: Forbidden - admin permission required or demo mode restriction
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Admin permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
                demo_mode:
                  summary: API token creation disabled in demo mode
                  value:
                    error:
                      code: "DEMO_MODE_RESTRICTION"
                      message: "API token creation is disabled in demo mode"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to create token
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

  /api/v1/tokens/{id}:
    get:
      tags: [Tokens]
      summary: Get token info
      description: Get token metadata (not the token value)
      operationId: getToken
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Token info
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIToken'
        '400':
          description: Bad request - invalid ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_id:
                  summary: Invalid token ID
                  value:
                    error:
                      code: "INVALID_ID"
                      message: "Invalid token ID"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - admin permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Admin permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '404':
          description: Token not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                not_found:
                  summary: Token not found
                  value:
                    error:
                      code: "NOT_FOUND"
                      message: "Token not found"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to retrieve token
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

    delete:
      tags: [Tokens]
      summary: Revoke token
      description: Revoke an API token (requires password confirmation)
      operationId: deleteToken
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                password:
                  type: string
                  description: Password confirmation required for token deletion
              required:
                - password
      responses:
        '204':
          description: Token revoked
        '400':
          description: Bad request - invalid ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_id:
                  summary: Invalid token ID
                  value:
                    error:
                      code: "INVALID_ID"
                      message: "Invalid token ID"
        '401':
          description: Unauthorized - password required or invalid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
                password_required:
                  summary: Password required for token deletion
                  value:
                    error:
                      code: "PASSWORD_REQUIRED"
                      message: "Password is required to delete API tokens"
                invalid_password:
                  summary: Invalid password
                  value:
                    error:
                      code: "INVALID_PASSWORD"
                      message: "Invalid password"
        '403':
          description: Forbidden - admin permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Admin permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '404':
          description: Token not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                not_found:
                  summary: Token not found
                  value:
                    error:
                      code: "NOT_FOUND"
                      message: "Token not found"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to delete token
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

  /api/v1/backup/export:
    get:
      tags: [Backup]
      summary: Export backup
      description: Export all data as JSON or ZIP, optionally encrypted
      operationId: exportBackup
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: format
          in: query
          description: Export format
          schema:
            type: string
            enum: [json, zip]
            default: json
        - name: password
          in: query
          description: Optional encryption password
          schema:
            type: string
      responses:
        '200':
          description: Backup file
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BackupData'
            application/zip:
              schema:
                type: string
                format: binary
            application/octet-stream:
              schema:
                type: string
                format: binary
                description: Encrypted backup
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - admin permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Admin permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error - backup failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                backup_failed:
                  summary: Failed to create backup
                  value:
                    error:
                      code: "BACKUP_FAILED"
                      message: "Failed to export backup"

  /api/v1/backup/import:
    post:
      tags: [Backup]
      summary: Import backup
      description: Import data from a backup file
      operationId: importBackup
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
                  description: Backup file (JSON or ZIP)
                strategy:
                  type: string
                  enum: [replace, merge, skip]
                  default: merge
                  description: |
                    - replace: Clear all data and import
                    - merge: Add new items, keep existing
                    - skip: Only add items that don't exist
                password:
                  type: string
                  description: Decryption password if backup is encrypted
      responses:
        '200':
          description: Import result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImportResult'
        '400':
          description: Bad request - invalid file or format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_request:
                  summary: Failed to parse form data
                  value:
                    error:
                      code: "INVALID_REQUEST"
                      message: "Failed to parse form data"
                missing_file:
                  summary: No backup file provided
                  value:
                    error:
                      code: "MISSING_FILE"
                      message: "No backup file provided"
                read_error:
                  summary: Failed to read backup file
                  value:
                    error:
                      code: "READ_ERROR"
                      message: "Failed to read backup file"
                decryption_failed:
                  summary: Wrong decryption password
                  value:
                    error:
                      code: "DECRYPTION_FAILED"
                      message: "Failed to decrypt backup - wrong password?"
                invalid_format:
                  summary: Invalid backup file format
                  value:
                    error:
                      code: "INVALID_FORMAT"
                      message: "Invalid backup file format"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - admin permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Admin permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error - import failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                import_failed:
                  summary: Failed to import backup
                  value:
                    error:
                      code: "IMPORT_FAILED"
                      message: "Failed to import backup"

  /api/v1/backup/s3/status:
    get:
      tags: [Backup]
      summary: S3 status
      description: Check if S3 storage is configured
      operationId: s3Status
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      responses:
        '200':
          description: S3 configuration status
          content:
            application/json:
              schema:
                type: object
                properties:
                  enabled:
                    type: boolean
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - admin permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Admin permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"

  /api/v1/backup/s3/sync:
    post:
      tags: [Backup]
      summary: Sync to S3
      description: Upload a backup to S3 storage
      operationId: s3Sync
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExportOptions'
      responses:
        '200':
          description: Sync result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/S3SyncResult'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - admin permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Admin permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error - sync failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                sync_failed:
                  summary: Failed to sync to S3
                  value:
                    error:
                      code: "SYNC_FAILED"
                      message: "Failed to sync backup to S3"
        '503':
          description: S3 not configured
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                s3_not_configured:
                  summary: S3 storage not configured
                  value:
                    error:
                      code: "S3_NOT_CONFIGURED"
                      message: "S3 storage is not configured"

  /api/v1/backup/s3/list:
    get:
      tags: [Backup]
      summary: List S3 backups
      description: List all backups stored in S3
      operationId: s3List
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      responses:
        '200':
          description: List of S3 backups
          content:
            application/json:
              schema:
                type: object
                properties:
                  backups:
                    type: array
                    items:
                      $ref: '#/components/schemas/S3BackupInfo'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - admin permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Admin permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error - list failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                list_failed:
                  summary: Failed to list S3 backups
                  value:
                    error:
                      code: "LIST_FAILED"
                      message: "Failed to list backups from S3"
        '503':
          description: S3 not configured
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                s3_not_configured:
                  summary: S3 storage not configured
                  value:
                    error:
                      code: "S3_NOT_CONFIGURED"
                      message: "S3 storage is not configured"

  /api/v1/backup/s3/restore:
    post:
      tags: [Backup]
      summary: Restore from S3
      description: Restore data from an S3 backup
      operationId: s3Restore
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [key]
              properties:
                key:
                  type: string
                  description: S3 object key
                strategy:
                  type: string
                  enum: [replace, merge, skip]
                  default: merge
                password:
                  type: string
                  description: Decryption password if backup is encrypted
      responses:
        '200':
          description: Restore result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImportResult'
        '400':
          description: Bad request - invalid request or missing key
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_request:
                  summary: Invalid request body
                  value:
                    error:
                      code: "INVALID_REQUEST"
                      message: "Invalid request body"
                missing_key:
                  summary: Backup key is required
                  value:
                    error:
                      code: "MISSING_KEY"
                      message: "Backup key is required"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - admin permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Admin permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error - restore failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                restore_failed:
                  summary: Failed to restore from S3
                  value:
                    error:
                      code: "RESTORE_FAILED"
                      message: "Failed to restore backup from S3"
        '503':
          description: S3 not configured
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                s3_not_configured:
                  summary: S3 storage not configured
                  value:
                    error:
                      code: "S3_NOT_CONFIGURED"
                      message: "S3 storage is not configured"

  /api/v1/backup/s3/delete:
    delete:
      tags: [Backup]
      summary: Delete S3 backup
      description: Delete a backup from S3 storage
      operationId: s3Delete
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      parameters:
        - name: key
          in: query
          required: true
          description: S3 object key to delete
          schema:
            type: string
      responses:
        '200':
          description: Backup deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - Backup deleted successfully
        '400':
          description: Bad request - missing key
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missing_key:
                  summary: Backup key is required
                  value:
                    error:
                      code: "MISSING_KEY"
                      message: "Backup key is required"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - admin permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Admin permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error - delete failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                delete_failed:
                  summary: Failed to delete S3 backup
                  value:
                    error:
                      code: "DELETE_FAILED"
                      message: "Failed to delete backup from S3"
        '503':
          description: S3 not configured
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                s3_not_configured:
                  summary: S3 storage not configured
                  value:
                    error:
                      code: "S3_NOT_CONFIGURED"
                      message: "S3 storage is not configured"

  /api/v1/settings:
    get:
      tags: [Settings]
      summary: Get settings
      description: |
        Get application settings including theme, editor preferences, and S3 configuration.
        Requires admin permission.
      operationId: getSettings
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      responses:
        '200':
          description: Settings retrieved successfully
          headers:
            X-Request-ID:
              schema:
                type: string
                format: uuid
            X-API-Version:
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Settings'
                  meta:
                    $ref: '#/components/schemas/Meta'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - admin permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Admin permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to retrieve settings
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

    put:
      tags: [Settings]
      summary: Update settings
      description: |
        Update application settings.
        Requires admin permission.
        All fields are validated.
      operationId: updateSettings
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SettingsInput'
            examples:
              theme_update:
                summary: Update theme settings
                value:
                  theme: "dark"
                  editor_theme: "monokai"
              font_update:
                summary: Update font sizes
                value:
                  font_size: 14
                  tab_size: 2
                  markdown_font_size: 16
              feature_toggle:
                summary: Enable/disable features
                value:
                  archive_enabled: true
                  history_enabled: true
              full_update:
                summary: Update multiple settings
                value:
                  theme: "dark"
                  editor_theme: "tomorrow_night"
                  font_size: 16
                  tab_size: 4
                  markdown_font_size: 18
                  archive_enabled: true
                  history_enabled: true
      responses:
        '200':
          description: Settings updated successfully
          headers:
            X-Request-ID:
              schema:
                type: string
                format: uuid
              description: Unique request identifier
            X-API-Version:
              schema:
                type: string
              description: API version
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Settings'
                  meta:
                    $ref: '#/components/schemas/Meta'
              examples:
                success:
                  summary: Successful settings update
                  value:
                    data:
                      id: 1
                      theme: "dark"
                      editor_theme: "tomorrow_night"
                      font_size: 16
                      tab_size: 4
                      markdown_font_size: 18
                      archive_enabled: true
                      history_enabled: true
                      created_at: "2024-01-01T00:00:00Z"
                      updated_at: "2024-12-24T10:35:00Z"
                    meta:
                      request_id: "550e8400-e29b-41d4-a716-446655440005"
                      timestamp: "2024-12-24T10:35:00Z"
                      version: "1.0"
        '400':
          description: Bad request - invalid JSON or validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_json:
                  summary: Invalid JSON payload
                  value:
                    error:
                      code: "INVALID_JSON"
                      message: "Invalid request body"
                invalid_theme:
                  summary: Invalid theme value
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "theme"
                          message: "Theme must be 'light' or 'dark'"
                invalid_font_size:
                  summary: Font size out of range
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "font_size"
                          message: "Font size must be between 8 and 32"
                invalid_editor_theme:
                  summary: Unsupported editor theme
                  value:
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "editor_theme"
                          message: "Unsupported editor theme: 'invalid_theme'"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - admin permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Admin permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to update settings
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

  /api/v1/gist/config:
    get:
      tags: [GitHub Gist Sync]
      summary: Get GitHub Gist sync configuration
      description: Retrieves the current GitHub Gist sync configuration (token is masked)
      operationId: getGistConfig
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: Gist sync configuration
          content:
            application/json:
              schema:
                type: object
                properties:
                  enabled:
                    type: boolean
                  github_username:
                    type: string
                  has_token:
                    type: boolean
                  auto_sync_enabled:
                    type: boolean
                  sync_interval_minutes:
                    type: integer
                  conflict_resolution_strategy:
                    type: string
                    enum: [manual, snipo_wins, gist_wins, newest_wins]
                  last_full_sync_at:
                    type: string
                    format: date-time
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - admin permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Admin permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to retrieve configuration
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"
    
    post:
      tags: [GitHub Gist Sync]
      summary: Update GitHub Gist sync configuration
      description: Updates the GitHub Gist sync configuration and optionally sets a new token
      operationId: updateGistConfig
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                enabled:
                  type: boolean
                github_token:
                  type: string
                  description: GitHub Personal Access Token (optional, only when updating)
                auto_sync_enabled:
                  type: boolean
                sync_interval_minutes:
                  type: integer
                  minimum: 5
                conflict_resolution_strategy:
                  type: string
                  enum: [manual, snipo_wins, gist_wins, newest_wins]
      responses:
        '200':
          description: Configuration updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  username:
                    type: string
        '400':
          description: Invalid configuration
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_interval:
                  summary: Sync interval too short
                  value:
                    error:
                      code: "INVALID_INTERVAL"
                      message: "Sync interval must be at least 5 minutes"
                invalid_strategy:
                  summary: Invalid conflict resolution strategy
                  value:
                    error:
                      code: "INVALID_STRATEGY"
                      message: "Invalid conflict resolution strategy"
                invalid_token:
                  summary: GitHub token validation failed
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Failed to validate GitHub token"
                invalid_json:
                  summary: Invalid JSON payload
                  value:
                    error:
                      code: "INVALID_JSON"
                      message: "Invalid request body"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - admin permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Admin permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to update configuration
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"
    
    delete:
      tags: [GitHub Gist Sync]
      summary: Clear GitHub Gist sync configuration
      description: Removes the GitHub token and disables sync
      operationId: clearGistConfig
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: Configuration cleared
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - admin permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Admin permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to clear configuration
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

  /api/v1/gist/config/test:
    post:
      tags: [GitHub Gist Sync]
      summary: Test GitHub connection
      description: Tests the configured GitHub token by attempting to authenticate
      operationId: testGistConnection
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: Connection successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  username:
                    type: string
        '400':
          description: No token configured or invalid token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                sync_not_configured:
                  summary: No GitHub token configured
                  value:
                    error:
                      code: "SYNC_NOT_CONFIGURED"
                      message: "GitHub token not configured"
                invalid_token:
                  summary: Invalid GitHub token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "GitHub token is invalid or expired"
                no_token:
                  summary: No token configured
                  value:
                    error:
                      code: "NO_TOKEN"
                      message: "No GitHub token configured"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - admin permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Admin permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to test connection
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

  /api/v1/gist/sync/enable-all:
    post:
      tags: [GitHub Gist Sync]
      summary: Enable sync for all snippets
      description: Creates GitHub gists for all snippets and enables sync
      operationId: enableSyncForAll
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: Sync enabled for snippets
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  enabled:
                    type: integer
                  errors:
                    type: integer
                  error_messages:
                    type: array
                    items:
                      type: string
        '400':
          description: Sync not configured
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                not_configured:
                  summary: GitHub sync not configured
                  value:
                    error:
                      code: "SYNC_NOT_CONFIGURED"
                      message: "GitHub token not configured"
                fetch_failed:
                  summary: Failed to fetch snippets
                  value:
                    error:
                      code: "FETCH_FAILED"
                      message: "Failed to fetch snippets"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - write permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Write permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to enable sync
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

  /api/v1/gist/sync/all:
    post:
      tags: [GitHub Gist Sync]
      summary: Sync all enabled snippets
      description: Syncs all snippets that have sync enabled
      operationId: syncAllGists
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: Sync completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_processed:
                    type: integer
                  synced:
                    type: integer
                  conflicts:
                    type: integer
                  errors:
                    type: integer
                  error_messages:
                    type: array
                    items:
                      type: string
                  duration:
                    type: string
        '400':
          description: Sync not configured
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                not_configured:
                  summary: GitHub sync not configured
                  value:
                    error:
                      code: "SYNC_NOT_CONFIGURED"
                      message: "GitHub token not configured"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - write permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Write permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                sync_failed:
                  summary: Failed to sync snippets
                  value:
                    error:
                      code: "SYNC_FAILED"
                      message: "Failed to sync snippets"

  /api/v1/gist/sync/enable/{id}:
    post:
      tags: [GitHub Gist Sync]
      summary: Enable sync for a snippet
      description: Creates a GitHub gist for the snippet and enables sync
      operationId: enableSyncForSnippet
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Snippet ID
      responses:
        '200':
          description: Sync enabled
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                sync_not_configured:
                  summary: Sync not configured
                  value:
                    error:
                      code: "SYNC_NOT_CONFIGURED"
                      message: "GitHub token not configured"
                snippet_not_found:
                  summary: Snippet not found
                  value:
                    error:
                      code: "NOT_FOUND"
                      message: "Snippet not found"
                missing_id:
                  summary: Missing snippet ID
                  value:
                    error:
                      code: "MISSING_ID"
                      message: "Snippet ID is required"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - write permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Write permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                enable_failed:
                  summary: Failed to enable sync
                  value:
                    error:
                      code: "ENABLE_FAILED"
                      message: "Failed to enable sync for snippet"

  /api/v1/gist/sync/disable/{id}:
    post:
      tags: [GitHub Gist Sync]
      summary: Disable sync for a snippet
      description: Disables sync for the snippet (does not delete the gist)
      operationId: disableSyncForSnippet
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Snippet ID
      responses:
        '200':
          description: Sync disabled
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                disable_failed:
                  summary: Failed to disable sync
                  value:
                    error:
                      code: "DISABLE_FAILED"
                      message: "Failed to disable sync for snippet"
                sync_not_configured:
                  summary: Sync not configured
                  value:
                    error:
                      code: "SYNC_NOT_CONFIGURED"
                      message: "GitHub token not configured"
                missing_id:
                  summary: Missing snippet ID
                  value:
                    error:
                      code: "MISSING_ID"
                      message: "Snippet ID is required"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - write permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Write permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                disable_failed:
                  summary: Failed to disable sync
                  value:
                    error:
                      code: "DISABLE_FAILED"
                      message: "Failed to disable sync for snippet"

  /api/v1/gist/sync/snippet/{id}:
    post:
      tags: [GitHub Gist Sync]
      summary: Sync a specific snippet
      description: Syncs a specific snippet with its GitHub gist
      operationId: syncSnippet
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Snippet ID
      responses:
        '200':
          description: Snippet synced
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                sync_not_configured:
                  summary: Sync not configured
                  value:
                    error:
                      code: "SYNC_NOT_CONFIGURED"
                      message: "GitHub token not configured"
                snippet_not_found:
                  summary: Snippet not found
                  value:
                    error:
                      code: "NOT_FOUND"
                      message: "Snippet not found"
                missing_id:
                  summary: Missing snippet ID
                  value:
                    error:
                      code: "MISSING_ID"
                      message: "Snippet ID is required"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - write permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Write permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                sync_failed:
                  summary: Failed to sync snippet
                  value:
                    error:
                      code: "SYNC_FAILED"
                      message: "Failed to sync snippet"

  /api/v1/gist/mappings:
    get:
      tags: [GitHub Gist Sync]
      summary: List snippet-gist mappings
      description: Retrieves all snippet-gist mappings
      operationId: listGistMappings
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: List of mappings
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    snippet_id:
                      type: string
                    gist_id:
                      type: string
                    gist_url:
                      type: string
                    sync_enabled:
                      type: boolean
                    last_synced_at:
                      type: string
                      format: date-time
                    sync_status:
                      type: string
                      enum: [synced, pending, conflict, error]
                    error_message:
                      type: string
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - admin permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Admin permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to retrieve mappings
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

  /api/v1/gist/mappings/{id}:
    delete:
      tags: [GitHub Gist Sync]
      summary: Delete a snippet-gist mapping
      description: Removes the mapping (does not delete the gist or snippet)
      operationId: deleteGistMapping
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Mapping ID
      responses:
        '200':
          description: Mapping deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '400':
          description: Bad request - invalid ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_id:
                  summary: Invalid mapping ID
                  value:
                    error:
                      code: "INVALID_ID"
                      message: "Invalid mapping ID"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - admin permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Admin permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to delete mapping
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

  /api/v1/gist/conflicts:
    get:
      tags: [GitHub Gist Sync]
      summary: List sync conflicts
      description: Retrieves all unresolved sync conflicts
      operationId: listGistConflicts
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: List of conflicts
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    snippet_id:
                      type: string
                    gist_id:
                      type: string
                    snipo_version:
                      type: string
                    gist_version:
                      type: string
                    resolved:
                      type: boolean
                    created_at:
                      type: string
                      format: date-time
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - admin permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Admin permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to retrieve conflicts
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

  /api/v1/gist/conflicts/{id}/resolve:
    post:
      tags: [GitHub Gist Sync]
      summary: Resolve a sync conflict
      description: Resolves a conflict by choosing which version to keep
      operationId: resolveGistConflict
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Conflict ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - resolution
              properties:
                resolution:
                  type: string
                  enum: [snipo_wins, gist_wins]
      responses:
        '200':
          description: Conflict resolved
        '400':
          description: Invalid resolution choice
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_resolution:
                  summary: Invalid resolution choice
                  value:
                    error:
                      code: "INVALID_RESOLUTION"
                      message: "Invalid resolution choice"
                sync_not_configured:
                  summary: Sync not configured
                  value:
                    error:
                      code: "SYNC_NOT_CONFIGURED"
                      message: "GitHub token not configured"
                resolve_failed:
                  summary: Failed to resolve conflict
                  value:
                    error:
                      code: "RESOLVE_FAILED"
                      message: "Failed to resolve conflict"
                invalid_json:
                  summary: Invalid JSON payload
                  value:
                    error:
                      code: "INVALID_JSON"
                      message: "Invalid request body"
                invalid_id:
                  summary: Invalid conflict ID
                  value:
                    error:
                      code: "INVALID_ID"
                      message: "Invalid conflict ID"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - write permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Write permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                resolve_failed:
                  summary: Failed to resolve conflict
                  value:
                    error:
                      code: "RESOLVE_FAILED"
                      message: "Failed to resolve conflict"

  /api/v1/gist/logs:
    get:
      tags: [GitHub Gist Sync]
      summary: Get sync operation logs
      description: Retrieves recent sync operation logs
      operationId: getGistLogs
      security:
        - sessionCookie: []
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 50
          description: Maximum number of logs to return
      responses:
        '200':
          description: List of logs
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    snippet_id:
                      type: string
                    gist_id:
                      type: string
                    operation:
                      type: string
                      enum: [create, update, delete, sync]
                    status:
                      type: string
                      enum: [success, failed]
                    message:
                      type: string
                    created_at:
                      type: string
                      format: date-time
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_auth:
                  summary: No authentication provided
                  value:
                    error:
                      code: "UNAUTHORIZED"
                      message: "Authentication required"
                invalid_token:
                  summary: Invalid or expired token
                  value:
                    error:
                      code: "INVALID_TOKEN"
                      message: "Invalid or expired authentication token"
        '403':
          description: Forbidden - admin permission required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                insufficient_permissions:
                  summary: Admin permission required
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Insufficient permissions to perform this action"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                database_error:
                  summary: Failed to retrieve logs
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal server error occurred"

  /api/v1/openapi.json:
    get:
      tags: [Documentation]
      summary: Get OpenAPI specification
      description: |
        Returns the OpenAPI 3.1 specification for this API.
        This endpoint is publicly accessible (no authentication required).
      operationId: getOpenAPISpec
      responses:
        '200':
          description: OpenAPI specification
          content:
            application/yaml:
              schema:
                type: object
                description: OpenAPI 3.1 specification
        '404':
          description: OpenAPI specification file not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                file_not_found:
                  summary: Specification file not found
                  value:
                    error:
                      code: "NOT_FOUND"
                      message: "OpenAPI specification file not found"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                file_read_error:
                  summary: Failed to read specification file
                  value:
                    error:
                      code: "INTERNAL_ERROR"
                      message: "Failed to serve OpenAPI specification"

components:
  securitySchemes:
    sessionCookie:
      type: apiKey
      in: cookie
      name: snipo_session
      description: |
        Session-based authentication for web UI.
        Full admin access (equivalent to admin permission level).
    bearerAuth:
      type: http
      scheme: bearer
      description: |
        API token authentication using Bearer token.
        Permission level depends on token configuration:
        - **read**: GET endpoints only
        - **write**: GET, POST, PUT, DELETE for snippets, tags, folders
        - **admin**: Full access including tokens, settings, backups
    apiKey:
      type: apiKey
      in: header
      name: X-API-Key
      description: |
        API key authentication (alternative to Bearer token).
        Permission level depends on token configuration (read/write/admin).

  schemas:
    Error:
      type: object
      description: |
        Standard error response format. All errors include a code and message.
        
        **Common Error Codes:**
        
        **Authentication Errors (401):**
        - `UNAUTHORIZED`: Missing or invalid authentication credentials
        - `INVALID_TOKEN`: API token is invalid or expired
        - `SESSION_EXPIRED`: Session has expired, login required
        
        **Authorization Errors (403):**
        - `FORBIDDEN`: Insufficient permissions for this operation
        - `READ_ONLY_TOKEN`: Token has read-only permissions, write access required
        - `ADMIN_REQUIRED`: Operation requires admin-level permissions
        
        **Resource Errors (404):**
        - `NOT_FOUND`: Requested resource does not exist
        - `SNIPPET_NOT_FOUND`: Snippet with specified ID not found
        - `FOLDER_NOT_FOUND`: Folder with specified ID not found
        - `TAG_NOT_FOUND`: Tag with specified ID not found
        - `TOKEN_NOT_FOUND`: API token with specified ID not found
        - `HISTORY_NOT_FOUND`: History version not found
        
        **Rate Limiting (429):**
        - `RATE_LIMIT_EXCEEDED`: Too many requests, please slow down
          - Response includes `Retry-After` header with seconds to wait
          - Default limits: 100 req/min (authenticated), 20 req/min (public)
        
        **Server Errors (500):**
        - `INTERNAL_ERROR`: Unexpected server error occurred
        - `DATABASE_ERROR`: Database operation failed
        - `S3_ERROR`: S3 storage operation failed
      properties:
        error:
          type: object
          properties:
            code:
              type: string
              description: Machine-readable error code (see description for full list)
              examples:
                - "UNAUTHORIZED"
            message:
              type: string
              description: Human-readable error message
              examples:
                - "Authentication required"
      examples:
        - error:
            code: "FORBIDDEN"
            message: "Insufficient permissions to perform this action"

    ValidationError:
      type: object
      description: |
        Validation error response with detailed field-level errors.
        Returned when request data fails validation rules.
        
        **Validation Error Codes:**
        - `VALIDATION_ERROR`: Generic validation failure
        - `INVALID_TITLE`: Title validation failed (empty, too long, invalid format)
        - `INVALID_LANGUAGE`: Unsupported programming language specified
        - `INVALID_THEME`: Invalid theme value (must be 'light' or 'dark')
        - `INVALID_FONT_SIZE`: Font size out of range (8-32)
        - `INVALID_TAB_SIZE`: Tab size out of range (1-8)
        - `INVALID_EDITOR_THEME`: Unsupported editor theme specified
        - `INVALID_PAGE`: Page number must be >= 1
        - `INVALID_LIMIT`: Limit must be between 1 and 100
        - `INVALID_SORT`: Invalid sort field or direction
        - `INVALID_FILTER`: Invalid filter parameter or combination
        - `DUPLICATE_NAME`: Resource with this name already exists
        
        **Field-Level Validation Rules:**
        
        *Snippet Fields:*
        - `title`: Required, 1-500 characters, no leading/trailing whitespace
        - `content`: Optional, max 1MB
        - `language`: Optional, must be supported language
        - `description`: Optional, max 5000 characters
        - `folder_id`: Optional, must exist if provided
        - `tags`: Optional array, each tag 1-50 characters
        
        *Settings Fields:*
        - `theme`: Must be 'light' or 'dark'
        - `editor_theme`: Must be supported Ace editor theme
        - `font_size`: Integer between 8 and 32
        - `tab_size`: Integer between 1 and 8
        - `markdown_font_size`: Integer between 8 and 32
        
        *Tag/Folder Fields:*
        - `name`: Required, 1-100 characters, unique within scope
        - `description`: Optional, max 500 characters
        
        *Token Fields:*
        - `name`: Required, 1-100 characters
        - `permission`: Must be 'read', 'write', or 'admin'
        - `expires_at`: Optional, must be future date
      properties:
        error:
          type: object
          properties:
            code:
              type: string
              description: Error code (typically VALIDATION_ERROR)
              examples:
                - "VALIDATION_ERROR"
            message:
              type: string
              description: Human-readable error summary
              examples:
                - "Validation failed"
            details:
              type: array
              description: Array of field-specific validation errors
              items:
                type: object
                properties:
                  field:
                    type: string
                    description: Name of the field that failed validation
                    examples:
                      - "title"
                  message:
                    type: string
                    description: Specific validation error for this field
                    examples:
                      - "Title must not be empty"
      examples:
        - error:
            code: "VALIDATION_ERROR"
            message: "Validation failed"
            details:
              - field: "title"
                message: "Title must not be empty"
              - field: "font_size"
                message: "Font size must be between 8 and 32"

    # Standard Response Envelope
    Meta:
      type: object
      description: Metadata included in all API responses
      properties:
        request_id:
          type: string
          format: uuid
          description: Unique request identifier for tracking and debugging
          examples:
            - "550e8400-e29b-41d4-a716-446655440000"
        timestamp:
          type: string
          format: date-time
          description: UTC timestamp of the response
          examples:
            - "2024-12-24T10:30:00Z"
        version:
          type: string
          description: API version
          examples:
            - "1.0"

    PaginationLinks:
      type: object
      description: Navigation links for paginated responses
      properties:
        self:
          type: string
          description: Link to current page
          examples:
            - "/api/v1/snippets?page=1&limit=20"
        next:
          type: [string, "null"]
          description: Link to next page (null if on last page)
          examples:
            - "/api/v1/snippets?page=2&limit=20"
        prev:
          type: [string, "null"]
          description: Link to previous page (null if on first page)
          examples:
            - null

    Pagination:
      type: object
      description: Pagination metadata for list responses
      properties:
        page:
          type: integer
          description: Current page number (1-indexed)
          examples:
            - 1
        limit:
          type: integer
          description: Number of items per page
          examples:
            - 20
        total:
          type: integer
          description: Total number of items
          examples:
            - 150
        total_pages:
          type: integer
          description: Total number of pages
          examples:
            - 8
        links:
          $ref: '#/components/schemas/PaginationLinks'

    APIResponse:
      type: object
      description: Standard envelope for single resource responses
      properties:
        data:
          type: object
          description: The response payload
        meta:
          $ref: '#/components/schemas/Meta'

    ListResponse:
      type: object
      description: Standard envelope for list responses with pagination
      properties:
        data:
          type: array
          items: {}
          description: Array of items
        pagination:
          $ref: '#/components/schemas/Pagination'
        meta:
          $ref: '#/components/schemas/Meta'

    # Feature Flags
    FeatureFlags:
      type: object
      description: Enabled features in the API
      properties:
        public_snippets:
          type: boolean
          description: Whether public snippet sharing is enabled
        s3_sync:
          type: boolean
          description: Whether S3 sync is enabled
        api_tokens:
          type: boolean
          description: Whether API token creation is enabled
        backup_restore:
          type: boolean
          description: Whether backup/restore is enabled

    HealthResponse:
      type: object
      properties:
        status:
          type: string
          examples:
            - healthy
        version:
          type: string
          examples:
            - 1.0.0
        commit:
          type: string
          examples:
            - abc1234
        uptime:
          type: string
          examples:
            - "24h30m15s"
        checks:
          type: object
          properties:
            database:
              type: string
              examples:
                - healthy
        memory:
          type: object
          properties:
            alloc_mb:
              type: integer
            total_alloc_mb:
              type: integer
            sys_mb:
              type: integer
            num_gc:
              type: integer
        features:
          $ref: '#/components/schemas/FeatureFlags'
        timestamp:
          type: string
          format: date-time

    LoginRequest:
      type: object
      required: [password]
      properties:
        password:
          type: string

    LoginResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string

    ChangePasswordRequest:
      type: object
      required: [current_password, new_password]
      properties:
        current_password:
          type: string
        new_password:
          type: string
          minLength: 6

    Snippet:
      type: object
      properties:
        id:
          type: string
          examples:
            - a1b2c3d4e5f6
        title:
          type: string
          examples:
            - Docker Compose Template
        description:
          type: string
          examples:
            - Basic multi-container setup
        content:
          type: string
          description: Primary file content (legacy)
        language:
          type: string
          examples:
            - yaml
        is_favorite:
          type: boolean
        is_public:
          type: boolean
        view_count:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        tags:
          type: array
          items:
            $ref: '#/components/schemas/Tag'
        folders:
          type: array
          items:
            $ref: '#/components/schemas/Folder'
        files:
          type: array
          items:
            $ref: '#/components/schemas/SnippetFile'

    SnippetFile:
      type: object
      properties:
        id:
          type: integer
        filename:
          type: string
          examples:
            - main.js
        content:
          type: string
        language:
          type: string
          examples:
            - javascript
        sort_order:
          type: integer

    SnippetInput:
      type: object
      required: [title]
      properties:
        title:
          type: string
          maxLength: 200
        description:
          type: string
          maxLength: 1000
        content:
          type: string
          description: Legacy single-file content
        language:
          type: string
          default: plaintext
        tags:
          type: array
          items:
            type: string
          description: Tag names (auto-created if not exist)
        folder_id:
          type: [integer, "null"]
        is_public:
          type: boolean
          default: false
        files:
          type: array
          items:
            $ref: '#/components/schemas/SnippetFileInput'
          description: Multi-file content

    SnippetFileInput:
      type: object
      required: [filename]
      properties:
        id:
          type: integer
          description: File ID (0 for new files)
        filename:
          type: string
        content:
          type: string
        language:
          type: string

    SnippetListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Snippet'
        pagination:
          $ref: '#/components/schemas/Pagination'

    Tag:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
          examples:
            - docker
        color:
          type: string
          examples:
            - "#0db7ed"
        created_at:
          type: string
          format: date-time
        snippet_count:
          type: integer

    TagInput:
      type: object
      required: [name]
      properties:
        name:
          type: string
          maxLength: 50
        color:
          type: string
          default: "#6366f1"
          pattern: "^#[0-9a-fA-F]{6}$"

    Folder:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
          examples:
            - DevOps
        parent_id:
          type: [integer, "null"]
        icon:
          type: string
          default: folder
        sort_order:
          type: integer
        created_at:
          type: string
          format: date-time
        snippet_count:
          type: integer
        children:
          type: array
          items:
            $ref: '#/components/schemas/Folder'
          description: Only present when tree=true

    FolderInput:
      type: object
      required: [name]
      properties:
        name:
          type: string
          maxLength: 100
        parent_id:
          type: [integer, "null"]
        icon:
          type: string
        sort_order:
          type: integer

    APIToken:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
          examples:
            - CI/CD Token
        token:
          type: string
          description: Only returned on creation
        permissions:
          type: string
          enum: [read, write, admin]
        last_used_at:
          type: [string, "null"]
          format: date-time
        expires_at:
          type: [string, "null"]
          format: date-time
        created_at:
          type: string
          format: date-time

    APITokenInput:
      type: object
      required: [name]
      properties:
        name:
          type: string
          maxLength: 100
        permissions:
          type: string
          enum: [read, write, admin]
          default: read
        expires_at:
          type: [string, "null"]
          format: date-time

    BackupData:
      type: object
      properties:
        version:
          type: string
        created_at:
          type: string
          format: date-time
        snippets:
          type: array
          items:
            $ref: '#/components/schemas/Snippet'
        tags:
          type: array
          items:
            $ref: '#/components/schemas/Tag'
        folders:
          type: array
          items:
            $ref: '#/components/schemas/Folder'

    ExportOptions:
      type: object
      properties:
        format:
          type: string
          enum: [json, zip]
          default: json
        password:
          type: string
          description: Optional encryption password

    ImportResult:
      type: object
      properties:
        snippets_imported:
          type: integer
        tags_imported:
          type: integer
        folders_imported:
          type: integer
        errors:
          type: array
          items:
            type: string

    S3BackupInfo:
      type: object
      properties:
        key:
          type: string
          examples:
            - backups/snipo-backup-2024-12-01.json
        size:
          type: integer
        last_modified:
          type: string
          format: date-time

    S3SyncResult:
      type: object
      properties:
        uploaded:
          type: integer
        errors:
          type: array
          items:
            type: string
        started_at:
          type: string
          format: date-time
        finished_at:
          type: string
          format: date-time

    # Settings Schemas
    Settings:
      type: object
      properties:
        theme:
          type: string
          enum: [light, dark]
          examples:
            - dark
        editor_theme:
          type: string
          description: Ace editor theme (40+ supported themes)
          examples:
            - tomorrow_night
        font_size:
          type: integer
          minimum: 8
          maximum: 32
          description: Editor font size in pixels (0 = default)
          examples:
            - 14
        tab_size:
          type: integer
          minimum: 1
          maximum: 8
          description: Tab size in spaces (0 = default)
          examples:
            - 4
        markdown_font_size:
          type: integer
          minimum: 8
          maximum: 32
          description: Markdown preview font size (0 = default)
          examples:
            - 16
        archive_enabled:
          type: boolean
          description: Whether archive feature is enabled
        history_enabled:
          type: boolean
          description: Whether history tracking is enabled

    SettingsInput:
      type: object
      description: Settings update input with validation constraints
      properties:
        theme:
          type: string
          enum: [light, dark]
          description: UI theme
        editor_theme:
          type: string
          description: |
            Ace editor theme. Supported values include:
            ambiance, chaos, chrome, clouds, clouds_midnight, cobalt, crimson_editor,
            dawn, dracula, dreamweaver, eclipse, github, gob, gruvbox, idle_fingers,
            iplastic, katzenmilch, kr_theme, kuroir, merbivore, merbivore_soft,
            mono_industrial, monokai, nord_dark, pastel_on_dark, solarized_dark,
            solarized_light, sqlserver, terminal, textmate, tomorrow, tomorrow_night,
            tomorrow_night_blue, tomorrow_night_bright, tomorrow_night_eighties,
            twilight, vibrant_ink, xcode, and more.
        font_size:
          type: integer
          minimum: 8
          maximum: 32
          description: Editor font size (0 = use default)
        tab_size:
          type: integer
          minimum: 1
          maximum: 8
          description: Tab size (0 = use default)
        markdown_font_size:
          type: integer
          minimum: 8
          maximum: 32
          description: Markdown font size (0 = use default)
        archive_enabled:
          type: boolean
        history_enabled:
          type: boolean

    # History Schema
    HistoryEntry:
      type: object
      description: Snippet version history entry
      properties:
        id:
          type: string
          description: History entry ID
        snippet_id:
          type: string
          description: Associated snippet ID
        title:
          type: string
          description: Snippet title at this version
        content:
          type: string
          description: Snippet content at this version
        language:
          type: string
          description: Language at this version
        description:
          type: string
          description: Description at this version
        created_at:
          type: string
          format: date-time
          description: When this version was created

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            invalid_json:
              summary: Invalid JSON in request body
              value:
                error:
                  code: "INVALID_JSON"
                  message: "Invalid JSON in request body"
            missing_required_field:
              summary: Required field missing
              value:
                error:
                  code: "INVALID_REQUEST"
                  message: "Request body is required"
            invalid_parameter:
              summary: Invalid parameter value
              value:
                error:
                  code: "INVALID_PARAMETER"
                  message: "Invalid parameter value provided"

    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            no_auth:
              summary: No authentication provided
              value:
                error:
                  code: "UNAUTHORIZED"
                  message: "Authentication required"
            invalid_token:
              summary: Invalid or expired token
              value:
                error:
                  code: "INVALID_TOKEN"
                  message: "Invalid or expired authentication token"
            session_expired:
              summary: Session expired
              value:
                error:
                  code: "SESSION_EXPIRED"
                  message: "Your session has expired. Please log in again"

    Forbidden:
      description: Forbidden - insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            insufficient_permissions:
              summary: Insufficient permissions
              value:
                error:
                  code: "FORBIDDEN"
                  message: "Insufficient permissions to perform this action"
            read_only_token:
              summary: Read-only token used for write operation
              value:
                error:
                  code: "READ_ONLY"
                  message: "This token only has read permissions"
            admin_required:
              summary: Admin permission required
              value:
                error:
                  code: "ADMIN_REQUIRED"
                  message: "This operation requires admin-level permissions"

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            snippet_not_found:
              summary: Snippet not found
              value:
                error:
                  code: "NOT_FOUND"
                  message: "Snippet not found"
            tag_not_found:
              summary: Tag not found
              value:
                error:
                  code: "NOT_FOUND"
                  message: "Tag not found"
            folder_not_found:
              summary: Folder not found
              value:
                error:
                  code: "NOT_FOUND"
                  message: "Folder not found"
            resource_not_found:
              summary: Generic resource not found
              value:
                error:
                  code: "NOT_FOUND"
                  message: "The requested resource was not found"

    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ValidationError'
          examples:
            empty_title:
              summary: Empty title validation
              value:
                error:
                  code: "VALIDATION_ERROR"
                  message: "Validation failed"
                  details:
                    - field: "title"
                      message: "Title must not be empty"
            invalid_language:
              summary: Invalid language code
              value:
                error:
                  code: "VALIDATION_ERROR"
                  message: "Validation failed"
                  details:
                    - field: "language"
                      message: "Invalid language code"
            multiple_errors:
              summary: Multiple validation errors
              value:
                error:
                  code: "VALIDATION_ERROR"
                  message: "Validation failed"
                  details:
                    - field: "title"
                      message: "Title must not be empty"
                    - field: "content"
                      message: "Content is required"

    TooManyRequests:
      description: Rate limit exceeded
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            rate_limit_exceeded:
              summary: Rate limit exceeded
              value:
                error:
                  code: "RATE_LIMIT_EXCEEDED"
                  message: "Rate limit exceeded. Please try again later"
      headers:
        X-RateLimit-Limit:
          description: Maximum requests per window
          schema:
            type: integer
        X-RateLimit-Remaining:
          description: Requests remaining in current window
          schema:
            type: integer
        X-RateLimit-Reset:
          description: Unix timestamp when limit resets
          schema:
            type: integer
        Retry-After:
          description: Seconds to wait before retrying
          schema:
            type: integer

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            database_error:
              summary: Database operation failed
              value:
                error:
                  code: "DATABASE_ERROR"
                  message: "A database error occurred"
            internal_error:
              summary: Generic internal error
              value:
                error:
                  code: "INTERNAL_ERROR"
                  message: "An internal server error occurred"
